---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/stores/RootStore.ts
  - src/stores/CharacterStore.ts
  - src/stores/index.ts
  - src/App.tsx
  - src/main.tsx
autonomous: true

must_haves:
  truths:
    - "RootStore instantiates without errors"
    - "StoreProvider wraps the app at root level"
    - "useRootStore hook returns store instance in components"
    - "MobX spy logs actions in browser console during dev"
  artifacts:
    - path: "src/stores/RootStore.ts"
      provides: "Container for all domain stores"
      exports: ["RootStore"]
    - path: "src/stores/CharacterStore.ts"
      provides: "Character management store with placeholder methods"
      exports: ["CharacterStore"]
    - path: "src/stores/index.ts"
      provides: "React Context provider and hooks"
      exports: ["StoreProvider", "useRootStore", "useCharacterStore"]
  key_links:
    - from: "src/App.tsx"
      to: "src/stores/index.ts"
      via: "StoreProvider import and usage"
      pattern: "StoreProvider"
    - from: "src/stores/RootStore.ts"
      to: "src/stores/CharacterStore.ts"
      via: "store instantiation"
      pattern: "new CharacterStore"
    - from: "src/stores/CharacterStore.ts"
      to: "mobx"
      via: "makeAutoObservable"
      pattern: "makeAutoObservable"
---

<objective>
Implement the MobX root store pattern with React Context integration.

Purpose: Establish the state management architecture that all game systems will use. The CharacterStore is a placeholder that will hold Character entities in Plan 03.

Output: Working store infrastructure with StoreProvider at app root and hooks for accessing stores.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create store classes and React Context</name>
  <files>
    src/stores/RootStore.ts
    src/stores/CharacterStore.ts
    src/stores/index.ts
  </files>
  <action>
    1. Create src/stores/ directory

    2. Create src/stores/CharacterStore.ts:
       ```typescript
       import { makeAutoObservable } from 'mobx';
       import type { RootStore } from './RootStore';

       export class CharacterStore {
         // Will hold Character entity in Plan 03
         // Placeholder property to prove MobX works
         initialized = false;

         constructor(private root: RootStore) {
           makeAutoObservable(this);
         }

         // Placeholder action - will become createCharacter in Plan 03
         markInitialized(): void {
           this.initialized = true;
         }

         get isReady(): boolean {
           return this.initialized;
         }
       }
       ```

    3. Create src/stores/RootStore.ts:
       ```typescript
       import { CharacterStore } from './CharacterStore';

       export class RootStore {
         characterStore: CharacterStore;
         // Future: skillStore, activityStore, talentStore, resourceStore

         constructor() {
           this.characterStore = new CharacterStore(this);
         }
       }
       ```

    4. Create src/stores/index.ts with Context and hooks:
       ```typescript
       import { createContext, useContext, ReactNode, useState } from 'react';
       import { RootStore } from './RootStore';

       const StoreContext = createContext<RootStore | null>(null);

       interface StoreProviderProps {
         children: ReactNode;
       }

       export function StoreProvider({ children }: StoreProviderProps) {
         // useState ensures single instance across re-renders
         const [store] = useState(() => new RootStore());

         return (
           <StoreContext.Provider value={store}>
             {children}
           </StoreContext.Provider>
         );
       }

       export function useRootStore(): RootStore {
         const context = useContext(StoreContext);
         if (!context) {
           throw new Error('useRootStore must be used within StoreProvider');
         }
         return context;
       }

       // Convenience hooks for individual stores
       export function useCharacterStore() {
         return useRootStore().characterStore;
       }

       // Re-export for external use
       export { RootStore } from './RootStore';
       export { CharacterStore } from './CharacterStore';
       ```
  </action>
  <verify>
    - No TypeScript errors in store files
    - Files exist at correct paths
    - `npx tsc --noEmit` passes
  </verify>
  <done>
    Store classes created with MobX observables, Context provider and hooks ready for use.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire StoreProvider into app and add MobX debugging</name>
  <files>
    src/App.tsx
    src/main.tsx
  </files>
  <action>
    1. Update src/main.tsx to add MobX spy for development debugging:
       ```typescript
       import { StrictMode } from 'react';
       import { createRoot } from 'react-dom/client';
       import { spy } from 'mobx';
       import { StoreProvider } from './stores';
       import App from './App';
       import './index.css';

       // MobX debugging in development
       if (import.meta.env.DEV) {
         spy((event) => {
           if (event.type === 'action') {
             console.log(`[MobX] ${event.name}`, event.arguments);
           }
         });
       }

       createRoot(document.getElementById('root')!).render(
         <StrictMode>
           <StoreProvider>
             <App />
           </StoreProvider>
         </StrictMode>
       );
       ```

    2. Update src/App.tsx to use store and prove reactivity works:
       ```typescript
       import { observer } from 'mobx-react-lite';
       import { useCharacterStore } from './stores';

       const App = observer(function App() {
         const characterStore = useCharacterStore();

         return (
           <div className="min-h-screen bg-base-100 p-8">
             <h1 className="text-2xl font-bold text-base-content mb-4">
               Lifelines Prototype
             </h1>

             <div className="card bg-base-200 shadow-xl max-w-md">
               <div className="card-body">
                 <h2 className="card-title">Store Status</h2>
                 <p>
                   Character Store:{' '}
                   <span className={characterStore.isReady ? 'text-success' : 'text-warning'}>
                     {characterStore.isReady ? 'Ready' : 'Not initialized'}
                   </span>
                 </p>
                 <div className="card-actions justify-end">
                   <button
                     className="btn btn-primary"
                     onClick={() => characterStore.markInitialized()}
                     disabled={characterStore.isReady}
                   >
                     Initialize
                   </button>
                 </div>
               </div>
             </div>
           </div>
         );
       });

       export default App;
       ```
  </action>
  <verify>
    - `npm run dev` starts without errors
    - Page shows "Store Status" card with "Not initialized" text
    - Clicking "Initialize" button changes text to "Ready" (proves MobX reactivity)
    - Browser console shows `[MobX] markInitialized` when button clicked (proves spy works)
  </verify>
  <done>
    StoreProvider wraps app, MobX reactivity proven via button click, MobX spy logs actions to console.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run dev` starts the dev server
2. Page shows card with "Character Store: Not initialized"
3. Clicking "Initialize" button updates UI to "Character Store: Ready"
4. Browser console shows `[MobX] markInitialized []` when button clicked
5. `npm run lint` passes
6. `npx tsc --noEmit` passes
</verification>

<success_criteria>
- RootStore and CharacterStore classes exist and instantiate
- StoreProvider wraps the app in main.tsx
- useCharacterStore hook returns store instance
- MobX reactivity works: button click -> action -> observable change -> UI update
- MobX spy logs actions to browser console in dev mode
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
