---
phase: 02-character-core
plan: 05
type: execute
wave: 3
depends_on: [02-03, 02-04]
files_modified:
  - src/components/CharacterPanel.tsx
  - src/components/SimulationControls.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "CharacterPanel displays personality radar, capacities radar, and resource gauges"
    - "SimulationControls shows play/pause and speed adjustment"
    - "Resources visibly drain/recover in real-time when simulation runs"
    - "Personality sliders adjust traits and affect resource rates"
  artifacts:
    - path: "src/components/CharacterPanel.tsx"
      provides: "Unified sidebar with all character visualizations"
      exports: ["CharacterPanel"]
    - path: "src/components/SimulationControls.tsx"
      provides: "Play/pause and speed controls"
      exports: ["SimulationControls"]
    - path: "src/App.tsx"
      provides: "Updated layout with CharacterPanel sidebar"
      contains: "CharacterPanel"
  key_links:
    - from: "src/components/CharacterPanel.tsx"
      to: "src/components/PersonalityRadar.tsx"
      via: "imports and renders"
      pattern: "import.*PersonalityRadar"
    - from: "src/components/CharacterPanel.tsx"
      to: "src/components/ResourcePanel.tsx"
      via: "imports and renders"
      pattern: "import.*ResourcePanel"
    - from: "src/components/SimulationControls.tsx"
      to: "src/stores/SimulationStore.ts"
      via: "uses simulation store"
      pattern: "simulationStore"
---

<objective>
Create CharacterPanel sidebar and SimulationControls, wire everything together in App.tsx.

Purpose: Produces the final integrated UI where the user can observe the character's psychological state, adjust personality traits, and watch resources drain/recover in real-time.

Output:
- CharacterPanel component combining all visualizations
- SimulationControls for play/pause and speed
- Updated App.tsx with sidebar layout
- Human verification of the complete system
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-character-core/02-CONTEXT.md
@src/components/PersonalityRadar.tsx
@src/components/CapacitiesRadar.tsx
@src/components/ResourcePanel.tsx
@src/stores/SimulationStore.ts
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SimulationControls component</name>
  <files>src/components/SimulationControls.tsx</files>
  <action>
Create SimulationControls.tsx for play/pause and speed adjustment:

```tsx
import { observer } from 'mobx-react-lite';
import { useStore } from '../stores';

export const SimulationControls = observer(function SimulationControls() {
  const { simulationStore } = useStore();
  const { isRunning, speed, tickCount, formattedTime } = simulationStore;

  return (
    <div className="flex items-center gap-4 p-4 bg-base-200 rounded-lg">
      {/* Play/Pause */}
      <button
        className={`btn btn-circle ${isRunning ? 'btn-error' : 'btn-success'}`}
        onClick={() => isRunning ? simulationStore.stop() : simulationStore.start()}
        aria-label={isRunning ? 'Pause simulation' : 'Start simulation'}
      >
        {isRunning ? (
          <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <rect x="6" y="4" width="3" height="12" />
            <rect x="11" y="4" width="3" height="12" />
          </svg>
        ) : (
          <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <polygon points="5,3 19,10 5,17" />
          </svg>
        )}
      </button>

      {/* Speed slider */}
      <div className="flex flex-col gap-1">
        <label className="text-xs text-base-content/70">
          Speed: {speed}x
        </label>
        <input
          type="range"
          min="0"
          max="10"
          step="1"
          value={speed}
          onChange={(e) => simulationStore.setSpeed(Number(e.target.value))}
          className="range range-xs range-primary w-32"
        />
      </div>

      {/* Time display */}
      <div className="text-sm font-mono text-base-content/70">
        Tick: {tickCount} ({formattedTime})
      </div>
    </div>
  );
});
```
  </action>
  <verify>`npm run build` passes</verify>
  <done>SimulationControls renders with play/pause button and speed slider</done>
</task>

<task type="auto">
  <name>Task 2: Create CharacterPanel and update App.tsx</name>
  <files>src/components/CharacterPanel.tsx, src/App.tsx</files>
  <action>
Create CharacterPanel.tsx - the unified sidebar per CONTEXT.md (resources most prominent, persistent sidebar):

```tsx
import { observer } from 'mobx-react-lite';
import { useStore } from '../stores';
import { PersonalityRadar } from './PersonalityRadar';
import { CapacitiesRadar } from './CapacitiesRadar';
import { ResourcePanel } from './ResourcePanel';

export const CharacterPanel = observer(function CharacterPanel() {
  const { characterStore } = useStore();
  const character = characterStore.character;

  if (!character) {
    return (
      <div className="w-80 p-4 bg-base-200 h-screen">
        <p className="text-base-content/50">No character created</p>
      </div>
    );
  }

  return (
    <div className="w-80 bg-base-200 h-screen overflow-y-auto flex flex-col">
      {/* Header with name */}
      <div className="p-4 border-b border-base-300">
        <h2 className="text-lg font-bold">{character.displayName}</h2>
        {character.isExhausted && (
          <span className="badge badge-error badge-sm">Exhausted</span>
        )}
        {character.isOverstressed && (
          <span className="badge badge-warning badge-sm ml-1">Stressed</span>
        )}
        {character.isSociallyDrained && (
          <span className="badge badge-info badge-sm ml-1">Drained</span>
        )}
      </div>

      {/* Resources - most prominent per CONTEXT.md */}
      <div className="p-4 border-b border-base-300">
        <h3 className="text-sm font-semibold mb-2 text-base-content/70">Resources</h3>
        <ResourcePanel resources={character.resources} />
      </div>

      {/* Personality radar */}
      <div className="p-4 border-b border-base-300">
        <h3 className="text-sm font-semibold mb-2 text-base-content/70">Personality</h3>
        <PersonalityRadar personality={character.personality} />
        {/* Dev sliders for testing emergence per CONTEXT.md */}
        <details className="mt-2">
          <summary className="text-xs text-base-content/50 cursor-pointer">
            Adjust (dev)
          </summary>
          <div className="flex flex-col gap-2 mt-2">
            {Object.entries(character.personality).map(([key, value]) => (
              <div key={key} className="flex items-center gap-2">
                <label className="text-xs w-24 capitalize">{key}</label>
                <input
                  type="range"
                  min="0"
                  max="100"
                  value={value}
                  onChange={(e) =>
                    character.updatePersonality({ [key]: Number(e.target.value) })
                  }
                  className="range range-xs w-full"
                />
                <span className="text-xs w-8 text-right">{value}</span>
              </div>
            ))}
          </div>
        </details>
      </div>

      {/* Capacities radar */}
      <div className="p-4">
        <h3 className="text-sm font-semibold mb-2 text-base-content/70">Capacities</h3>
        <CapacitiesRadar capacities={character.capacities} />
      </div>
    </div>
  );
});
```

Update App.tsx to use sidebar layout:

```tsx
import { observer } from 'mobx-react-lite';
import { useStore } from './stores';
import { CharacterPanel } from './components/CharacterPanel';
import { SimulationControls } from './components/SimulationControls';

const App = observer(function App() {
  const { characterStore } = useStore();

  // Create a character on first render if none exists
  if (!characterStore.hasCharacter) {
    characterStore.createCharacter('Test Character');
  }

  return (
    <div className="flex min-h-screen bg-base-100">
      {/* Sidebar */}
      <CharacterPanel />

      {/* Main content */}
      <div className="flex-1 p-8">
        <h1 className="text-2xl font-bold mb-6">Lifelines Prototype</h1>
        <SimulationControls />

        <div className="mt-8 prose">
          <p>
            Start the simulation to watch resources drain based on personality.
            Adjust personality sliders in the sidebar to see how traits affect rates.
          </p>
        </div>
      </div>
    </div>
  );
});

export default App;
```
  </action>
  <verify>`npm run dev` shows sidebar with character panel and main area with simulation controls</verify>
  <done>App shows CharacterPanel sidebar with all visualizations and SimulationControls in main area</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 2 character system with personality, capacities, resources, and time-based simulation</what-built>
  <how-to-verify>
    1. Run `npm run dev` and open http://localhost:5173
    2. Verify CharacterPanel sidebar shows:
       - Character name at top
       - 9 resource gauges in 3x3 grid (Resources section)
       - Pentagon radar chart for Big Five personality (Personality section)
       - Hexagon radar chart for 6 capacities (Capacities section)
    3. Click play button in SimulationControls
    4. Watch resources drain over time (energy, socialBattery, focus, nutrition, overskudd should decrease)
    5. Watch stress recover (decrease) over time
    6. Expand "Adjust (dev)" under Personality
    7. Set Extraversion to 10 (very introverted)
    8. Observe socialBattery drains faster than before
    9. Set Neuroticism to 90 (very neurotic)
    10. Observe stress increases faster / recovers slower
    11. Verify gauges change color: green (70+), yellow (30-70), red (<30)
    12. Verify stress gauge is inverted: red when high, green when low
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- App renders with sidebar layout
- CharacterPanel shows all three systems (personality, capacities, resources)
- SimulationControls work (play/pause, speed adjustment)
- Resources visibly change over time when simulation runs
- Personality sliders affect resource drain/recovery rates
- Boundary badges appear (Exhausted, Stressed, Drained) at appropriate thresholds
</verification>

<success_criteria>
Phase 2 Success Criteria (from ROADMAP.md):
1. Character displays Big Five personality dimensions visually (radar chart)
2. Character displays mental capacities visually (radar chart)
3. Character displays resources (energy, social battery, stress) visually (gauges)
4. Personality affects resource drain rates (low extraversion = faster social drain)
5. Resources drain/recover over time based on personality

All must be verifiable through the human checkpoint.
</success_criteria>

<output>
After completion, create `.planning/phases/02-character-core/02-05-SUMMARY.md`
</output>
