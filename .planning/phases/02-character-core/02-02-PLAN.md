---
phase: 02-character-core
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/SimulationStore.ts
  - src/stores/RootStore.ts
  - src/stores/index.tsx
autonomous: true

must_haves:
  truths:
    - "SimulationStore exists with start/stop/tick methods"
    - "Simulation speed is adjustable (0-10x)"
    - "RootStore exposes simulationStore"
  artifacts:
    - path: "src/stores/SimulationStore.ts"
      provides: "Centralized simulation clock"
      exports: ["SimulationStore"]
    - path: "src/stores/RootStore.ts"
      provides: "Root store with simulation integration"
      contains: "simulationStore"
  key_links:
    - from: "src/stores/RootStore.ts"
      to: "src/stores/SimulationStore.ts"
      via: "instantiates SimulationStore"
      pattern: "new SimulationStore"
---

<objective>
Create SimulationStore for centralized time management and clock ticks.

Purpose: Establishes the single source of truth for simulation time, preventing timer drift and enabling speed control for debugging.

Output:
- SimulationStore class with tick/start/stop/setSpeed methods
- RootStore integration
- React Context updated to include simulationStore
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-character-core/02-RESEARCH.md
@src/stores/RootStore.ts
@src/stores/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SimulationStore</name>
  <files>src/stores/SimulationStore.ts</files>
  <action>
Create SimulationStore following the pattern from RESEARCH.md:

```typescript
import { makeAutoObservable, action } from 'mobx';
import type { RootStore } from './RootStore';

export class SimulationStore {
  // Observable state
  tickCount = 0;
  speed = 1;  // 0 = paused, 1 = normal, up to 10x
  isRunning = false;

  // Private
  private intervalHandle: number | null = null;
  private readonly TICK_RATE_MS = 1000;
  private readonly root: RootStore;

  constructor(root: RootStore) {
    this.root = root;
    makeAutoObservable(this, {
      start: action,
      stop: action,
      tick: action,
      setSpeed: action,
    });
  }

  start(): void {
    if (this.intervalHandle !== null) return;
    this.isRunning = true;
    this.intervalHandle = window.setInterval(() => {
      if (this.speed > 0) {
        this.tick();
      }
    }, this.TICK_RATE_MS);
  }

  stop(): void {
    if (this.intervalHandle !== null) {
      clearInterval(this.intervalHandle);
      this.intervalHandle = null;
    }
    this.isRunning = false;
  }

  tick(): void {
    this.tickCount += 1;
    // Character update will be added in 02-03
    // this.root.characterStore.character?.applyTickUpdate(this.speed);
  }

  setSpeed(newSpeed: number): void {
    this.speed = Math.max(0, Math.min(10, newSpeed));
  }

  // Computed: formatted time display
  get formattedTime(): string {
    const minutes = Math.floor(this.tickCount / 60);
    const seconds = this.tickCount % 60;
    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }
}
```

Key points:
- Single setInterval, not multiple timers (anti-pattern from RESEARCH.md)
- Speed clamped 0-10x
- isRunning observable for UI feedback
- formattedTime computed for display
  </action>
  <verify>`npm run build` passes</verify>
  <done>SimulationStore.ts exists with start/stop/tick/setSpeed methods</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SimulationStore into RootStore</name>
  <files>src/stores/RootStore.ts, src/stores/index.tsx</files>
  <action>
Update RootStore to include simulationStore:

```typescript
// src/stores/RootStore.ts
import { CharacterStore } from './CharacterStore';
import { SimulationStore } from './SimulationStore';

export class RootStore {
  characterStore: CharacterStore;
  simulationStore: SimulationStore;
  // Future: skillStore, activityStore, talentStore

  constructor() {
    this.characterStore = new CharacterStore(this);
    this.simulationStore = new SimulationStore(this);
  }
}
```

Update index.tsx exports if needed to ensure SimulationStore is accessible.
The React Context provider already uses RootStore, so no changes needed there.
  </action>
  <verify>`npm run build` passes, `npm run lint` passes</verify>
  <done>RootStore instantiates simulationStore, accessible via React Context</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- `npm run lint` passes
- SimulationStore has: tickCount, speed, isRunning observables
- SimulationStore has: start, stop, tick, setSpeed actions
- RootStore exposes simulationStore property
</verification>

<success_criteria>
1. SimulationStore exists with clock singleton pattern
2. Single timer prevents drift (RESEARCH.md anti-pattern avoided)
3. Speed adjustable 0-10x for debugging
4. RootStore integrates simulationStore
5. All code compiles and lints cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-character-core/02-02-SUMMARY.md`
</output>
