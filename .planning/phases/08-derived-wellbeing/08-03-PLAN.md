---
phase: 08-derived-wellbeing
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - src/components/MoodIcon.tsx
  - src/components/DerivedStatsSection.tsx
  - src/components/NeedsPanel.tsx
  - src/components/CharacterPanel.tsx
autonomous: true

must_haves:
  truths:
    - "MoodIcon displays emoji based on mood value (sad/neutral/content/happy)"
    - "MoodIcon tooltip shows mood breakdown with need contributions"
    - "DerivedStatsSection displays Mood, Purpose, and Nutrition with visual grouping"
    - "Purpose bar shows equilibrium marker indicating personality baseline"
    - "NeedsPanel includes DerivedStatsSection below primary needs with visual separator"
  artifacts:
    - path: "src/components/MoodIcon.tsx"
      provides: "Emoji-based mood indicator with tooltip breakdown"
      exports: ["MoodIcon"]
    - path: "src/components/DerivedStatsSection.tsx"
      provides: "Derived wellbeing stats display section"
      exports: ["DerivedStatsSection"]
    - path: "src/components/NeedsPanel.tsx"
      provides: "Extended panel with derived stats section"
      contains: "DerivedStatsSection"
  key_links:
    - from: "src/components/NeedsPanel.tsx"
      to: "src/components/DerivedStatsSection.tsx"
      via: "import and render"
      pattern: "import.*DerivedStatsSection"
    - from: "src/components/DerivedStatsSection.tsx"
      to: "src/components/MoodIcon.tsx"
      via: "import and render"
      pattern: "import.*MoodIcon"
    - from: "src/components/CharacterPanel.tsx"
      to: "Character computed getters"
      via: "passing props to NeedsPanel"
      pattern: "character\\.moodBreakdown"
---

<objective>
Create UI components for displaying derived wellbeing stats: MoodIcon (emoji with tooltip), DerivedStatsSection (grouped display), and integrate into NeedsPanel.

Purpose: Players can see Mood as an intuitive emoji indicator, understand what's affecting their mood via tooltip breakdown, observe Purpose relative to equilibrium, and track Nutrition as a slow-moving stat. Visual separation between Primary Needs and Derived Wellbeing clarifies the system hierarchy.

Output: MoodIcon.tsx, DerivedStatsSection.tsx created; NeedsPanel.tsx extended to include derived stats.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-derived-wellbeing/08-CONTEXT.md
@.planning/phases/08-derived-wellbeing/08-RESEARCH.md
@.planning/phases/08-derived-wellbeing/08-02-SUMMARY.md
@src/components/NeedsPanel.tsx
@src/components/NeedBar.tsx
@src/entities/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MoodIcon Component</name>
  <files>src/components/MoodIcon.tsx</files>
  <action>
Create src/components/MoodIcon.tsx:

1. Import observer from mobx-react-lite
2. Import StatBreakdown from ../entities/types

3. Define props interface MoodIconProps:
   - value: number (mood value 0-100)
   - breakdown: StatBreakdown (contributions for tooltip)

4. Create getMoodEmoji(value: number): string helper:
   - value >= 75: return 'üòä' (happy)
   - value >= 50: return 'üôÇ' (content)
   - value >= 25: return 'üòê' (neutral)
   - otherwise: return 'üò¢' (sad)

5. Create MoodIcon component:
   - Get emoji from getMoodEmoji(value)
   - Format tooltip text:
     - First line: "Mood: {breakdown.total}"
     - Empty line
     - Each contribution: "{source}: {+/-}{value}" (show + prefix for positive)
   - Render using DaisyUI tooltip:
     ```jsx
     <div className="tooltip tooltip-right whitespace-pre-line" data-tip={tooltipText}>
       <span className="text-4xl cursor-help" role="img" aria-label={`mood: ${emoji}`}>
         {emoji}
       </span>
     </div>
     ```

6. Export MoodIcon as named export with observer wrapper.

Use whitespace-pre-line class to preserve newlines in tooltip.
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`</verify>
  <done>MoodIcon component displays emoji based on mood value with tooltip showing breakdown</done>
</task>

<task type="auto">
  <name>Task 2: Create DerivedStatsSection Component</name>
  <files>src/components/DerivedStatsSection.tsx</files>
  <action>
Create src/components/DerivedStatsSection.tsx:

1. Import observer from mobx-react-lite
2. Import MoodIcon from ./MoodIcon
3. Import DerivedStats, StatBreakdown from ../entities/types

4. Define props interface DerivedStatsSectionProps:
   - derivedStats: DerivedStats
   - moodBreakdown: StatBreakdown
   - purposeEquilibrium: number

5. Create helper functions:
   - getPurposeColor(value: number): string
     - value >= 60: 'progress-info'
     - value >= 40: 'progress-warning'
     - otherwise: 'progress-error'
   - getNutritionColor(value: number): string
     - value >= 70: 'progress-success'
     - value >= 40: 'progress-warning'
     - otherwise: 'progress-error'

6. Create DerivedStatsSection component with layout:
   ```jsx
   <div className="border-t border-base-300 pt-4 mt-4">
     <h4 className="text-xs font-semibold uppercase tracking-wide text-base-content/70 mb-3">
       Derived Wellbeing
     </h4>

     <div className="flex flex-col gap-4">
       {/* Mood row - centered icon */}
       <div className="flex items-center gap-3">
         <span className="text-sm text-base-content/70 w-16">Mood</span>
         <MoodIcon value={derivedStats.mood} breakdown={moodBreakdown} />
         <span className="text-sm text-base-content/50">
           {Math.round(derivedStats.mood)}%
         </span>
       </div>

       {/* Purpose row - bar with equilibrium */}
       <div className="flex flex-col gap-1">
         <div className="flex justify-between text-xs">
           <span>Purpose</span>
           <span className="text-base-content/70">{Math.round(derivedStats.purpose)}%</span>
         </div>
         <progress
           className={`progress ${getPurposeColor(derivedStats.purpose)} w-full h-2`}
           value={derivedStats.purpose}
           max="100"
         />
         <div className="flex justify-between text-xs text-base-content/50">
           <span>Equilibrium: {Math.round(purposeEquilibrium)}%</span>
           <span className="opacity-60">‚Üî personality baseline</span>
         </div>
       </div>

       {/* Nutrition row - bar with slow indicator */}
       <div className="flex flex-col gap-1">
         <div className="flex justify-between text-xs">
           <span>Nutrition</span>
           <span className="text-base-content/70">{Math.round(derivedStats.nutrition)}%</span>
         </div>
         <progress
           className={`progress ${getNutritionColor(derivedStats.nutrition)} w-full h-2`}
           value={derivedStats.nutrition}
           max="100"
         />
         <span className="text-xs text-base-content/50">
           (changes slowly based on diet)
         </span>
       </div>
     </div>
   </div>
   ```

7. Export DerivedStatsSection as named export with observer wrapper.
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`</verify>
  <done>DerivedStatsSection displays Mood (icon), Purpose (bar with equilibrium), and Nutrition (bar) with visual grouping</done>
</task>

<task type="auto">
  <name>Task 3: Integrate DerivedStatsSection into NeedsPanel</name>
  <files>src/components/NeedsPanel.tsx</files>
  <action>
Update src/components/NeedsPanel.tsx to include DerivedStatsSection:

1. Add imports:
   - Import DerivedStatsSection from ./DerivedStatsSection
   - Import DerivedStats, StatBreakdown from ../entities/types

2. Update NeedsPanelProps interface:
   - Add derivedStats?: DerivedStats (optional, may not be initialized)
   - Add moodBreakdown?: StatBreakdown (optional)
   - Add purposeEquilibrium?: number (optional)

3. In the component, after the Social needs section, add:
   ```jsx
   {/* Derived Wellbeing - only show if derivedStats available */}
   {derivedStats && moodBreakdown && purposeEquilibrium !== undefined && (
     <DerivedStatsSection
       derivedStats={derivedStats}
       moodBreakdown={moodBreakdown}
       purposeEquilibrium={purposeEquilibrium}
     />
   )}
   ```

4. The border-t on DerivedStatsSection creates visual separator from primary needs.
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`</verify>
  <done>NeedsPanel conditionally renders DerivedStatsSection when derivedStats available</done>
</task>

<task type="auto">
  <name>Task 4: Wire Derived Stats Props in CharacterPanel</name>
  <files>src/components/CharacterPanel.tsx</files>
  <action>
Update src/components/CharacterPanel.tsx to pass derived stats props to NeedsPanel:

1. Find the NeedsPanel rendering section (around line 43-46).

2. Update the NeedsPanel component to pass the new props:
   ```jsx
   <NeedsPanel
     needs={character.needs}
     needsConfig={root.balanceConfig.needsConfig}
     derivedStats={character.derivedStats}
     moodBreakdown={character.moodBreakdown}
     purposeEquilibrium={character.purposeEquilibrium}
   />
   ```

The Character computed getters (moodBreakdown, purposeEquilibrium) were added in Plan 02.
derivedStats is also a Character property added in Plan 02.

No additional imports needed - just pass the props from character to NeedsPanel.
  </action>
  <verify>TypeScript compilation passes: `npx tsc --noEmit`</verify>
  <done>CharacterPanel passes derivedStats, moodBreakdown, and purposeEquilibrium to NeedsPanel</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - All TypeScript compiles without errors
2. MoodIcon displays correct emoji for different mood ranges
3. MoodIcon tooltip shows breakdown with contributions
4. DerivedStatsSection displays all three derived stats
5. Purpose shows equilibrium value
6. Nutrition shows "changes slowly" indicator
7. NeedsPanel conditionally shows derived stats when available
8. Visual separator (border-t) distinguishes primary needs from derived stats
</verification>

<success_criteria>
- Mood displayed as emoji with tooltip breakdown showing need contributions
- Purpose bar shows current value and personality equilibrium baseline
- Nutrition bar shows slow-changing diet quality
- Clear visual separation between Primary Needs and Derived Wellbeing
- Components compile and export correctly
</success_criteria>

<output>
After completion, create `.planning/phases/08-derived-wellbeing/08-03-SUMMARY.md`
</output>
