---
phase: 09.1-activity-difficulty
verified: 2026-01-23T22:30:00Z
status: gaps_found
score: 2/5 must-haves verified
gaps:
  - truth: "Each activity has a difficulty rating that affects Overskudd/Willpower/Focus costs"
    status: failed
    reason: "Difficulty calculation exists but does NOT affect resource costs"
    artifacts:
      - path: "src/entities/Activity.ts"
        issue: "getEffectiveDifficulty exists (lines 193-202) but is never used in cost calculations"
      - path: "src/stores/ActivityStore.ts"
        issue: "applyResourceEffects (line 341) only uses mastery, not difficulty"
    missing:
      - "Integration of difficulty into resource cost calculations"
      - "Modify applyResourceEffects to scale costs by effective difficulty"
      - "Higher difficulty → higher Overskudd/Willpower/Focus costs"
  
  - truth: "Personality alignment modifies difficulty (aligned activities feel easier)"
    status: failed
    reason: "Personality is not factored into difficulty calculation at all"
    artifacts:
      - path: "src/entities/Activity.ts"
        issue: "calculateSkillReduction and calculateMasteryReduction exist, but no personality modifier"
      - path: "src/types/difficulty.ts"
        issue: "DifficultyBreakdown has no personalityReduction field"
    missing:
      - "Personality alignment calculation (domain-personality fit)"
      - "PersonalityModifier in difficulty calculation methods"
      - "UI display of personality contribution in breakdown tooltip"
  
  - truth: "Difficulty calculations integrate with action resource gating from Phase 9"
    status: failed
    reason: "Difficulty exists, Phase 9 resource gating exists, but they are NOT integrated"
    artifacts:
      - path: "src/stores/ActivityStore.ts"
        issue: "canStart checks minOverskudd (Phase 9) but does not consider difficulty-adjusted costs"
    missing:
      - "Pre-flight cost estimation using difficulty"
      - "Block activity start if difficulty-adjusted costs would deplete resources critically"
      - "Show estimated costs in activity selection UI"
---

# Phase 9.1: Activity Difficulty Verification Report

**Phase Goal:** Activities have difficulty ratings that determine resource costs, with calculations based on skill level and mastery.

**Verified:** 2026-01-23T22:30:00Z

**Status:** gaps_found

**Re-verification:** No — initial verification

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Each activity has a difficulty rating that affects Overskudd/Willpower/Focus costs | ✗ FAILED | Difficulty ratings exist (baseDifficulty 1-5 on all activities), calculation methods exist (getEffectiveDifficulty), BUT difficulty is never used in cost calculations. ActivityStore.applyResourceEffects only uses mastery, not difficulty. |
| 2 | Skill level reduces effective difficulty (skilled patient finds activity easier) | ✓ VERIFIED | Activity.calculateSkillReduction (lines 133-166) uses square root diminishing returns. Skill requirements exist on all 8 starter activities. Testing shows difficulty decreases as skills level up (per 09.1-03-SUMMARY human verification). |
| 3 | Personality alignment modifies difficulty (aligned activities feel easier) | ✗ FAILED | No personality factor in difficulty calculation. Only skills and mastery affect difficulty. DifficultyBreakdown has no personality fields. |
| 4 | Player can see difficulty rating and cost breakdown before selecting activity | ⚠️ PARTIAL | Player can see difficulty stars (DifficultyStars component) and tooltip breakdown showing skill/mastery contributions. BUT cost breakdown is missing — no display of estimated Overskudd/Willpower/Focus costs based on difficulty. |
| 5 | Difficulty calculations integrate with action resource gating from Phase 9 | ✗ FAILED | Phase 9 resource gating exists (minOverskudd checks), difficulty calculation exists, but they are NOT connected. No difficulty-based cost estimation, no pre-flight resource checks. |

**Score:** 2/5 truths verified (skill reduction works, UI displays difficulty)

### Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `src/types/difficulty.ts` | SkillRequirement, DifficultyBreakdown, DifficultyConfig interfaces | ✓ VERIFIED | 57 lines, exports all required types. SkillRequirement (lines 5-12), DifficultyBreakdown (lines 32-43), DifficultyConfig (lines 49-56). No stubs. |
| `src/config/balance.ts` | DifficultyConfig in BalanceConfig | ✓ VERIFIED | DEFAULT_DIFFICULTY_CONFIG defined (lines 221-225), included in BalanceConfig interface (line 262), accessible via difficultyConfig getter (line 342). |
| `src/entities/types.ts` | ActivityData with optional baseDifficulty and skillRequirements | ✓ VERIFIED | Lines 301-302 add optional fields to ActivityData interface with SkillRequirement import (line 239). |
| `src/entities/Activity.ts` | Difficulty calculation methods | ✓ VERIFIED | 248 lines, substantive implementation. calculateSkillReduction (lines 133-166), calculateMasteryReduction (lines 174-184), getEffectiveDifficulty (lines 193-202), getDifficultyBreakdown (lines 211-246). All use square root diminishing returns as designed. |
| `src/data/activities.ts` | Skill requirements on starter activities | ✓ VERIFIED | All 8 STARTER_ACTIVITIES have baseDifficulty (1-5) and skillRequirements arrays. Harder activities (phone-call 4★, visit-store 4★) have more requirements. Rest/hobby have empty requirements. |
| `src/components/DifficultyStars.tsx` | Star display with popover breakdown | ✓ VERIFIED | 143 lines, substantive. Uses DaisyUI rating with mask-star-2 (lines 88-94). Color-coded by difficulty (getDifficultyColor lines 36-40). Native Popover API tooltip (lines 98-137). Filters skills with 0 reduction (line 119). |
| `src/components/ActivityCard.tsx` | Integrated difficulty display | ✓ VERIFIED | 166 lines. Imports DifficultyStars (line 6), accepts character prop (line 16), calculates difficulty (lines 42-52), displays stars (lines 83-87), shows skill requirements as badges (lines 108-134). |

**All core artifacts exist and are substantive.**

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|----|--------|---------|
| `Activity.ts` | `types/difficulty.ts` | import | ✓ WIRED | Line 9 imports SkillRequirement, DifficultyBreakdown. Used in methods. |
| `Activity.ts` | `Character.getSkill` | method call | ✓ WIRED | Line 143: `character.getSkill(req.skillId)`. Character has getSkill method (delegating to skillStore). |
| `Activity.ts` | `STARTER_SKILLS` | import | ✓ WIRED | Line 11 imports STARTER_SKILLS. Used in getDifficultyBreakdown (line 223) to look up skill names. |
| `DifficultyStars.tsx` | `Activity.getDifficultyBreakdown` | prop | ✓ WIRED | Receives breakdown prop from parent (line 9), displays in popover (lines 98-137). |
| `ActivityCard.tsx` | `DifficultyStars` | component | ✓ WIRED | Line 6 import, lines 83-87 render with difficulty and breakdown props. |
| `ActivityCard.tsx` | `Activity.getEffectiveDifficulty` | method call | ✓ WIRED | Line 44: `activity.getEffectiveDifficulty(character)`. Returns personalized difficulty. |
| `ActivityPanel.tsx` | `ActivityCard` | character prop | ✓ WIRED | Line 83: passes `character={character ?? undefined}` for personalized difficulty. |
| **`Activity.difficulty`** | **`ActivityStore.applyResourceEffects`** | **integration** | **✗ NOT_WIRED** | **applyResourceEffects (line 341) only uses mastery (line 352), NOT difficulty. Costs are NOT scaled by difficulty.** |
| **`Activity.difficulty`** | **`ActivityStore.canStart`** | **pre-flight check** | **✗ NOT_WIRED** | **canStart does not estimate difficulty-adjusted costs. No blocking based on whether character can afford difficulty-scaled resource drain.** |

**Critical wiring gaps:** Difficulty calculation is complete and displayed in UI, but NOT connected to resource cost system or activity gating.

### Requirements Coverage

| Requirement | Status | Blocking Issue |
|-------------|--------|----------------|
| ACTV-02: Activity resource costs decrease as relevant skills improve | ✗ BLOCKED | Skills reduce difficulty, but difficulty does NOT affect costs. Mastery affects costs (masteryDrainReduction), but skill-based difficulty reduction is not wired to cost system. |

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| None | N/A | No TODO/FIXME/placeholder patterns found | ℹ️ Info | Code is clean, well-documented, no stubs |

**Note:** While no anti-patterns exist in the difficulty system itself, the MISSING integration with cost system is a design gap, not a code smell.

### Human Verification Required

**Note:** Plan 09.1-03 included human verification checkpoint. Summary claims "All 5 tests passed after bug fixes." However, tests focused on UI visibility and personalization, NOT on whether difficulty affects costs (which is impossible to verify visually since the integration doesn't exist).

#### 1. Verify Difficulty-Cost Integration (After Gap Closure)

**Test:** 
1. Create character with low skill in "Phone Call" (0-1 level)
2. Note Overskudd/Willpower before attempting "Practice Phone Call" (4★ activity)
3. Execute activity, observe resource drain
4. Level up "Phone Call" skill to 10
5. Attempt same activity again, observe resource drain

**Expected:** 
- At skill level 0: Activity has ~4★ difficulty, costs MORE Overskudd/Willpower
- At skill level 10: Activity has ~2-3★ difficulty (due to skill reduction), costs LESS Overskudd/Willpower

**Why human:** 
Need to observe actual in-game resource changes during activity execution to confirm difficulty-based cost scaling works.

#### 2. Verify Personality Alignment Affects Difficulty (After Gap Closure)

**Test:**
1. Create character with high Extraversion (80+)
2. Check difficulty of "Chat with Neighbor" (social activity)
3. Create character with low Extraversion (20-)
4. Check difficulty of same activity

**Expected:**
- High Extraversion → social activities show lower difficulty (personality alignment bonus)
- Low Extraversion → social activities show higher difficulty (personality misalignment penalty)

**Why human:**
Visual inspection of difficulty stars and tooltip to confirm personality modifier is factored in.

## Gaps Summary

Phase 9.1 successfully implemented the difficulty calculation foundation and UI display, but **failed to connect difficulty to resource costs** — the core goal stated in ROADMAP.md ("difficulty ratings that **determine resource costs**").

**What exists:**
- Robust difficulty calculation system with skill/mastery modifiers
- Visual difficulty stars with color-coding
- Interactive tooltip showing breakdown
- All 8 starter activities have difficulty ratings and skill requirements

**What's missing:**
1. **Difficulty → Cost integration:** applyResourceEffects ignores difficulty entirely
2. **Personality → Difficulty integration:** No personality alignment modifier in calculations
3. **Pre-flight cost estimation:** Player cannot see estimated resource costs before starting activity
4. **Resource gating by difficulty:** canStart doesn't check if character can afford difficulty-scaled costs

**Why this happened:**
Reviewing 09.1-CONTEXT.md and RESEARCH.md, there's a note: "Phase 9.1 focuses on CALCULATION. Phase 10 will integrate with needs/resources." This suggests the team intentionally deferred cost integration to Phase 10. However, ROADMAP.md success criterion 1 explicitly states difficulty "affects Overskudd/Willpower/Focus costs" as part of Phase 9.1, creating a gap between plan scope and phase goal.

**Impact:**
- Requirement ACTV-02 is blocked (costs don't decrease as skills improve via difficulty)
- Players see difficulty stars but they have no mechanical effect on gameplay
- The difficulty system is "decoration" until integrated with costs

---

_Verified: 2026-01-23T22:30:00Z_
_Verifier: Claude (gsd-verifier)_
