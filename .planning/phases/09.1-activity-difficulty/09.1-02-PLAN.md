---
phase: 09.1-activity-difficulty
plan: 02
type: execute
wave: 2
depends_on: ["09.1-01"]
files_modified:
  - src/data/activities.ts
  - src/components/DifficultyStars.tsx
  - src/components/ActivityCard.tsx
autonomous: true

must_haves:
  truths:
    - "Activities have skill requirements with weights assigned"
    - "Player can see difficulty stars on activity cards"
    - "Tooltip shows difficulty breakdown on hover"
    - "Stars are color-coded by difficulty (green/yellow/red)"
    - "Different patients see different star counts for same activity"
  artifacts:
    - path: "src/data/activities.ts"
      provides: "Skill requirements on starter activities"
      contains: "skillRequirements"
    - path: "src/components/DifficultyStars.tsx"
      provides: "Star display with popover breakdown"
      exports: ["DifficultyStars"]
    - path: "src/components/ActivityCard.tsx"
      provides: "Integrated difficulty display"
      contains: "DifficultyStars"
  key_links:
    - from: "src/components/DifficultyStars.tsx"
      to: "Activity.getDifficultyBreakdown"
      via: "breakdown prop from parent"
      pattern: "breakdown"
    - from: "src/components/ActivityCard.tsx"
      to: "src/components/DifficultyStars.tsx"
      via: "component import"
      pattern: "import.*DifficultyStars"
    - from: "src/components/ActivityCard.tsx"
      to: "Activity.getEffectiveDifficulty"
      via: "computing difficulty from activity + character"
      pattern: "getEffectiveDifficulty"
---

<objective>
Add skill requirements to activities and create the UI for displaying personalized difficulty with interactive tooltip breakdown.

Purpose: Player can see at a glance how hard an activity is for their specific patient and understand what skills contribute to difficulty reduction.
Output: Visual difficulty system integrated into activity selection UI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09.1-activity-difficulty/09.1-CONTEXT.md

# Prior plan output
@.planning/phases/09.1-activity-difficulty/09.1-01-SUMMARY.md

# Existing patterns
@src/components/ActivityCard.tsx
@src/components/ActionResourcesSection.tsx
@src/data/activities.ts
@src/data/skills.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Skill Requirements to Activities</name>
  <files>src/data/activities.ts</files>
  <action>
Add `baseDifficulty` and `skillRequirements` to each activity in STARTER_ACTIVITIES:

Social activities:
- `chat-with-neighbor`: baseDifficulty 2, skillRequirements: [{ skillId: 'small-talk', weight: 1.0, maxReduction: 0.8 }, { skillId: 'eye-contact', weight: 0.5, maxReduction: 0.4 }]
- `phone-call-practice`: baseDifficulty 4, skillRequirements: [{ skillId: 'phone-call', weight: 1.0, maxReduction: 1.0 }, { skillId: 'small-talk', weight: 0.5, maxReduction: 0.5 }]

Organisational activities:
- `plan-tomorrow`: baseDifficulty 2, skillRequirements: [{ skillId: 'make-list', weight: 1.0, maxReduction: 0.8 }, { skillId: 'follow-routine', weight: 0.3, maxReduction: 0.3 }]
- `tidy-room`: baseDifficulty 3, skillRequirements: [{ skillId: 'follow-routine', weight: 1.0, maxReduction: 0.8 }, { skillId: 'make-list', weight: 0.4, maxReduction: 0.4 }]

Physical activities:
- `go-for-walk`: baseDifficulty 2, skillRequirements: [{ skillId: 'go-outside', weight: 1.0, maxReduction: 0.8 }, { skillId: 'walk-neighborhood', weight: 0.5, maxReduction: 0.5 }]
- `visit-store`: baseDifficulty 4, skillRequirements: [{ skillId: 'go-to-store', weight: 1.0, maxReduction: 1.0 }, { skillId: 'go-outside', weight: 0.3, maxReduction: 0.3 }, { skillId: 'make-list', weight: 0.3, maxReduction: 0.3 }]

Restorative activities (low/no difficulty):
- `rest`: baseDifficulty 1, skillRequirements: [] (anyone can rest)
- `solo-hobby`: baseDifficulty 2, skillRequirements: [] (no skill requirements for hobbies)

Import SkillRequirement type from '../types/difficulty'.
  </action>
  <verify>
TypeScript compiles: `npm run build` or `npx tsc --noEmit`
  </verify>
  <done>
All STARTER_ACTIVITIES have baseDifficulty (1-5) and skillRequirements arrays. Harder activities (phone-call, visit-store) have more/higher requirements.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DifficultyStars Component</name>
  <files>src/components/DifficultyStars.tsx (new)</files>
  <action>
Create `src/components/DifficultyStars.tsx`:

1. Import React, useId, useRef from 'react'
2. Import observer from 'mobx-react-lite'
3. Import DifficultyBreakdown from '../types/difficulty'

4. Create color mapping function:
   - 1-2 stars: 'text-success' (green)
   - 2.5-3.5 stars: 'text-warning' (yellow)
   - 4-5 stars: 'text-error' (red)

5. Create DifficultyStars component with props:
   - `difficulty: number` (effective difficulty 1-5)
   - `breakdown?: DifficultyBreakdown` (optional for tooltip)
   - `size?: 'xs' | 'sm' | 'md'` (default 'sm')

6. Implement star display:
   - Full stars: `'★'.repeat(Math.floor(difficulty))`
   - Empty stars: `'☆'.repeat(5 - Math.floor(difficulty))`
   - Apply color class based on difficulty

7. Implement native Popover API tooltip (matching ActionResourcesSection pattern):
   - Use `popover="manual"` attribute
   - Position to right of trigger on mouseenter
   - Hide on mouseleave
   - Show breakdown content:
     - Header: "Difficulty: X.X★"
     - Base: {base}★
     - Skills: {skillReduction}★ (if non-zero)
     - Mastery: {masteryReduction}★ (if non-zero)
     - Per-skill details section (if skillDetails has items)

8. Export DifficultyStars as default and named export.

Use the exact same Popover API pattern from ActionResourcesSection.tsx for consistency.
  </action>
  <verify>
TypeScript compiles: `npm run build` or `npx tsc --noEmit`
  </verify>
  <done>
DifficultyStars component renders colored stars and shows popover breakdown on hover. Matches ActionResourcesSection tooltip pattern.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate Difficulty into ActivityCard</name>
  <files>src/components/ActivityCard.tsx</files>
  <action>
Update ActivityCard to display difficulty stars:

1. Add optional `character` prop to ActivityCardProps (for difficulty calculation)
2. Import DifficultyStars from './DifficultyStars'
3. Import Character type from '../entities/Character'

4. In the component:
   - If activity is Activity instance AND character is provided:
     - Call `activity.getEffectiveDifficulty(character)`
     - Call `activity.getDifficultyBreakdown(character)`
   - If activity is ActivityData (not instance):
     - Use `activity.baseDifficulty ?? 3` as fallback
     - No breakdown available

5. Display DifficultyStars in the header area (next to domain badge):
   - Pass difficulty and breakdown (if available)
   - Use size="xs" for compact display

6. Update effectsPreview to show difficulty-adjusted costs (optional enhancement):
   - If difficulty > 3, show costs as slightly higher
   - Color-code costs: green if affordable, red if would deplete resource

Keep the component backward compatible - if no character is provided, show base difficulty only without personalization.
  </action>
  <verify>
TypeScript compiles: `npm run build` or `npx tsc --noEmit`
Start dev server and visually confirm stars appear on activity cards.
  </verify>
  <done>
ActivityCard shows difficulty stars. When character is provided, stars reflect personalized difficulty. Hovering shows breakdown tooltip.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Activities in STARTER_ACTIVITIES have baseDifficulty and skillRequirements
3. DifficultyStars component exists and renders colored stars
4. ActivityCard displays difficulty stars in preview variant
5. Tooltip shows breakdown on hover (if breakdown available)
</verification>

<success_criteria>
- Player can see 1-5 difficulty stars on each activity card
- Stars are color-coded (green easy, yellow medium, red hard)
- Hover tooltip shows base difficulty and modifier breakdown
- Different patients see different effective difficulties for same activity
- UI matches established patterns (native Popover API, DaisyUI colors)
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-activity-difficulty/09.1-02-SUMMARY.md`
</output>
