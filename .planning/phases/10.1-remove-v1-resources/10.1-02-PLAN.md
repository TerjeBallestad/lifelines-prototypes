---
phase: 10.1-remove-v1-resources
plan: 02
type: execute
wave: 2
depends_on: ["10.1-01"]
files_modified:
  - src/stores/RootStore.ts
  - src/entities/Character.ts
  - src/stores/ActivityStore.ts
  - src/entities/types.ts
  - src/entities/Activity.ts
  - src/data/activities.ts
autonomous: true

must_haves:
  truths:
    - "Character.needs is required (not optional)"
    - "Character.actionResources is required (not optional)"
    - "RootStore has no needsSystemEnabled property"
    - "Activities have no resourceEffects property"
    - "Fresh game starts without runtime errors"
  artifacts:
    - path: "src/entities/Character.ts"
      provides: "Character entity with required v1.1 properties"
      not_contains: ["BASE_DRAIN_RATES", "BASE_RECOVERY_RATES", "resources:"]
    - path: "src/stores/RootStore.ts"
      provides: "Root store without toggle"
      not_contains: "needsSystemEnabled"
    - path: "src/entities/types.ts"
      provides: "Types without v1.0 Resources"
      not_contains: "export type Resources"
  key_links:
    - from: "src/entities/Character.ts"
      to: "defaultNeeds()"
      via: "constructor initialization"
      pattern: "this.needs = "
---

<objective>
Remove v1.0 resource system from stores, types, and data

Purpose: Complete the cleanup by removing all v1.0 code from the foundation layer, making v1.1 needs/action resources the only system.

Output: Clean codebase with no v1.0 resource remnants, all TypeScript errors resolved.
</objective>

<execution_context>
@/Users/godstemning/.claude/get-shit-done/workflows/execute-plan.md
@/Users/godstemning/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10.1-remove-v1-resources/10.1-RESEARCH.md
@.planning/phases/10.1-remove-v1-resources/10.1-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove toggle and v1.0 branches from stores</name>
  <files>
    src/stores/RootStore.ts
    src/stores/ActivityStore.ts
  </files>
  <action>
**RootStore.ts:**
1. Remove `needsSystemEnabled = false;` property declaration
2. Remove `toggleNeedsSystem()` method entirely
3. Remove the comment "// v1.1 Primary Needs System toggle"

**ActivityStore.ts:**
1. In `canStartActivity()`: Remove toggle checks, always use v1.1 action resources
   BEFORE: `const overskudd = this.root.needsSystemEnabled && character.actionResources ? character.actionResources.overskudd : character.resources.overskudd;`
   AFTER: `const overskudd = character.actionResources.overskudd;`

   BEFORE: `const energy = this.root.needsSystemEnabled && character.needs ? character.needs.energy : character.resources.energy;`
   AFTER: `const energy = character.needs.energy;`

2. In `completeActivity()`: Remove v1.0 penalty branch
   BEFORE: The else branch that drains `character.resources.overskudd` and `character.resources.mood`
   AFTER: Only keep the v1.1 branch that drains `character.actionResources.overskudd` and `character.actionResources.willpower`

3. In `applyResourceEffects()`: Remove the entire v1.0 resource effects block
   Delete the block: `if (!this.root.needsSystemEnabled) { ... }` (the whole for loop applying legacy resource effects)
   Keep only the v1.1 action resource costs and need restoration code

4. Remove unused import: `ResourceKey` (if no longer needed after removal)
  </action>
  <verify>
- `grep needsSystemEnabled src/stores/` returns no matches
- `grep "character.resources" src/stores/ActivityStore.ts` returns no matches
- `npm run typecheck` may have errors in Character.ts (expected, fixed in Task 2)
  </verify>
  <done>Stores reference only v1.1 system, no toggle or v1.0 fallbacks</done>
</task>

<task type="auto">
  <name>Task 2: Remove v1.0 from Character and make v1.1 required</name>
  <files>src/entities/Character.ts</files>
  <action>
**Remove v1.0 infrastructure:**
1. Remove import: `Resources`, `ResourceKey` from types import
2. Remove constants: `BASE_DRAIN_RATES`, `BASE_RECOVERY_RATES`
3. Remove property: `resources: Resources;`
4. Change properties from optional to required:
   - `needs?: Needs;` -> `needs: Needs;`
   - `derivedStats?: DerivedStats;` -> `derivedStats: DerivedStats;`
   - `actionResources?: ActionResources;` -> `actionResources: ActionResources;`

**Update constructor to always initialize v1.1:**
```typescript
constructor(data: CharacterData, root?: RootStore) {
  this.id = data.id;
  this.name = data.name;
  this.personality = data.personality;
  this.capacities = data.capacities;
  this.root = root;

  // Always initialize v1.1 properties
  this.needs = data.needs ?? defaultNeeds();
  this.derivedStats = defaultDerivedStats();
  this.actionResources = defaultActionResources();

  makeAutoObservable(this);
}
```

**Remove v1.0 methods:**
1. Remove `updateResources()` method
2. Remove `activeModifiers` getter (v1.0 personality modifiers for resource drain)
3. Remove `effectiveDrainRate()` method
4. Remove `effectiveRecoveryRate()` method
5. Remove `resourceModifierBreakdown` getter

**Update `applyTickUpdate()`:**
Remove the toggle branch entirely, always run v1.1 code:
```typescript
applyTickUpdate(speedMultiplier: number): void {
  // Always apply v1.1 system (no toggle)
  this.applyNeedsDecay(speedMultiplier);
  this.applyDerivedStatsUpdate(speedMultiplier);
  this.applyActionResourcesUpdate(speedMultiplier);
}
```

**Update `initializeNeeds()`:**
Remove the method or simplify it - needs are now initialized in constructor.
If kept for re-initialization purposes, update to not re-create needs:
```typescript
initializeNeeds(): void {
  // Re-initialize derived stats and smoothers
  this.initializeDerivedStats();
}
```

**Remove boundary state getters that reference v1.0 resources:**
Remove these computed getters (they reference character.resources which no longer exists):
- `get isExhausted()` - or reimplement using `this.needs.energy <= 10`
- `get isOverstressed()` - remove entirely (stress was v1.0 only, not in v1.1)
- `get isSociallyDrained()` - or reimplement using `this.actionResources.socialBattery <= 10`

**Decision:** Reimplement boundary getters using v1.1 properties since they're used in CharacterPanel badges:
```typescript
get isExhausted(): boolean {
  return this.needs.energy <= 10;
}

// isOverstressed removed (no stress in v1.1)

get isSociallyDrained(): boolean {
  return this.actionResources.socialBattery <= 10;
}
```

**Remove guard clauses that checked for optional properties:**
Throughout the file, remove `if (!this.needs)` and `if (!this.actionResources)` guards since these are now always initialized.
  </action>
  <verify>
- `grep "resources:" src/entities/Character.ts` returns no matches (property removed)
- `grep "BASE_DRAIN_RATES" src/entities/Character.ts` returns no matches
- `grep "needsSystemEnabled" src/entities/Character.ts` returns no matches
- TypeScript errors in Character.ts resolved
  </verify>
  <done>Character has required v1.1 properties, no v1.0 resources or methods</done>
</task>

<task type="auto">
  <name>Task 3: Remove v1.0 types and activity resourceEffects</name>
  <files>
    src/entities/types.ts
    src/entities/Activity.ts
    src/data/activities.ts
  </files>
  <action>
**types.ts:**
1. Remove `Resources` type entirely
2. Remove `ResourceKey` type entirely (if only used for v1.0)
3. Remove `defaultResources()` function
4. In `CharacterData` type: Remove `resources: Resources;` property
5. In `ActivityData` type: Remove `resourceEffects: Partial<Record<ResourceKey, number>>;` property
6. In `DurationMode` union: Keep 'threshold' mode but verify if it uses ResourceKey - if so, remove that variant or update to use NeedKey

Note: Check if `ResourceKey` is still needed anywhere. If not referenced after removal, delete it.

**Activity.ts:**
1. Remove `ResourceKey` from imports (if no longer needed)
2. Remove readonly property: `readonly resourceEffects: Partial<Record<ResourceKey, number>>;`
3. Remove from constructor: `this.resourceEffects = data.resourceEffects;`

**activities.ts:**
Remove `resourceEffects` from all 8 starter activities. Each activity definition should no longer have a `resourceEffects` property.

Example transformation:
```typescript
// BEFORE
{
  id: 'eating-meal',
  name: 'Eating a Meal',
  resourceEffects: {
    energy: 2,
    hunger: 5,
    mood: 1,
  },
  tags: ['routine'],
  needEffects: { hunger: 3, fun: 0.5 },
  ...
}

// AFTER
{
  id: 'eating-meal',
  name: 'Eating a Meal',
  tags: ['routine'],
  needEffects: { hunger: 3, fun: 0.5 },
  ...
}
```

Remove resourceEffects from all activities:
- eating-meal
- socializing
- exercise
- reading
- cleaning
- rest
- creative-work
- phone-call
  </action>
  <verify>
- `grep "export type Resources" src/entities/types.ts` returns no matches
- `grep "resourceEffects" src/entities/Activity.ts` returns no matches
- `grep "resourceEffects" src/data/activities.ts` returns no matches
- `npm run typecheck` passes (all TypeScript errors resolved)
  </verify>
  <done>v1.0 types removed, activities use only needEffects for v1.1</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run typecheck` passes with no errors
2. `npm run lint` passes (or only has unrelated warnings)
3. `grep -r "needsSystemEnabled" src/` returns no matches
4. `grep -r "Resources" src/entities/types.ts` returns no matches (for the type)
5. `grep -r "resourceEffects" src/` returns no matches
6. `grep "BASE_DRAIN_RATES\|BASE_RECOVERY_RATES" src/` returns no matches
</verification>

<success_criteria>
- All v1.0 code removed from stores, entities, and types
- Character properties (needs, derivedStats, actionResources) are required
- Constructor initializes v1.1 system immediately
- Activities only have needEffects, not resourceEffects
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10.1-remove-v1-resources/10.1-02-SUMMARY.md`
</output>
