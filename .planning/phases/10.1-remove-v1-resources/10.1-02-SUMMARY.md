---
phase: 10.1-remove-v1-resources
plan: 02
subsystem: core-data-model
tags: [refactor, cleanup, typescript, mobx]
requires: [10.1-01]
provides:
  - "v1.1 needs/action resources as required Character properties"
  - "Clean type system without v1.0 Resources/ResourceKey"
  - "Activities with only needEffects (no resourceEffects)"
affects: [10.1-03]
tech-stack:
  added: []
  patterns: ["required properties pattern", "constructor initialization"]
decisions:
  - decision: "Remove v1.0 resource system types and constants"
    rationale: "v1.1 needs/action resources fully replaces v1.0"
    impact: "Breaking change for saved data (handled by optional needs field in CharacterData)"
  - decision: "Remove threshold DurationMode variant"
    rationale: "Used ResourceKey which no longer exists, needThreshold variant covers use case"
    impact: "Simplifies duration mode types"
  - decision: "Reimplement boundary getters using v1.1 properties"
    rationale: "UI badges still need isExhausted and isSociallyDrained"
    impact: "Removed isOverstressed (stress was v1.0 only)"
key-files:
  created: []
  modified:
    - path: "src/stores/RootStore.ts"
      change: "Removed needsSystemEnabled toggle and toggleNeedsSystem()"
    - path: "src/stores/ActivityStore.ts"
      change: "Removed v1.0 fallback branches, always use v1.1 action resources"
    - path: "src/entities/Character.ts"
      change: "Made needs/derivedStats/actionResources required, removed v1.0 methods"
    - path: "src/entities/types.ts"
      change: "Removed Resources/ResourceKey types, removed threshold DurationMode"
    - path: "src/entities/Activity.ts"
      change: "Removed resourceEffects property"
    - path: "src/data/activities.ts"
      change: "Removed resourceEffects from all 8 starter activities"
    - path: "src/components/ActivityCard.tsx"
      change: "Removed dead resourceEffects preview section"
duration: 9.9 min
completed: 2026-01-25
---

# Phase 10.1 Plan 02: Remove v1.0 Resources from Core Summary

**Eliminated v1.0 resource system types, made v1.1 needs/action resources required properties**

## One-Liner

Removed all v1.0 Resources/ResourceKey types and constants, made Character.needs/derivedStats/actionResources required properties initialized in constructor, cleaned activity data to use only needEffects.

## Performance

- **Duration:** 9.9 min (591 seconds)
- **Started:** 2026-01-25T14:21:06Z
- **Completed:** 2026-01-25T14:30:57Z
- **Tasks:** 3 planned + 1 bug fix
- **Files modified:** 7 (7 modified, 0 deleted)

## Accomplishments

### Task 1: Remove toggle and v1.0 branches from stores

**Commit:** `7296753`

**Changes:**
- Removed `needsSystemEnabled` property from RootStore
- Removed `toggleNeedsSystem()` method from RootStore
- Removed v1.0 fallback branches from ActivityStore.canStartActivity()
- Removed v1.0 penalty branch from ActivityStore.completeActivity()
- Removed v1.0 resource effects loop from ActivityStore.applyResourceEffects()
- Removed unused ResourceKey import from ActivityStore

**Impact:** All stores now unconditionally use v1.1 action resources and needs system.

### Task 2: Make v1.1 properties required in Character

**Commit:** `f016786`

**Changes:**
- Removed Resources and ResourceKey imports from Character
- Removed BASE_DRAIN_RATES and BASE_RECOVERY_RATES constants
- Removed `resources: Resources` property
- Changed `needs?: Needs` to `needs: Needs` (required)
- Changed `derivedStats?: DerivedStats` to `derivedStats: DerivedStats` (required)
- Changed `actionResources?: ActionResources` to `actionResources: ActionResources` (required)
- Constructor always initializes v1.1 properties via defaultNeeds/defaultDerivedStats/defaultActionResources
- Removed `updateResources()` method
- Simplified `initializeNeeds()` to just reinitialize derived stats
- Removed all guards for optional properties (now always initialized)
- Removed v1.0 methods: `activeModifiers`, `effectiveDrainRate`, `effectiveRecoveryRate`, `resourceModifierBreakdown`
- Updated `applyTickUpdate()` to always run v1.1 system (no toggle)
- Updated boundary getters: `isExhausted` uses `needs.energy`, `isSociallyDrained` uses `actionResources.socialBattery`
- Removed `isOverstressed` (stress was v1.0 only)

**Impact:** Character entity is now purely v1.1, with 253 lines removed.

### Task 3: Remove v1.0 types and activity resourceEffects

**Commit:** `cb58766`

**Changes:**

**types.ts:**
- Removed `Resources` type and `ResourceKey` type
- Removed `defaultResources()` factory function
- Removed `threshold` mode from DurationMode (used ResourceKey)
- Removed `resourceEffects` from ActivityData type
- Updated CharacterData to have optional `needs` instead of required `resources`

**Activity.ts:**
- Removed ResourceKey import
- Removed `resourceEffects` property from Activity class
- Removed resourceEffects from constructor

**activities.ts:**
- Removed resourceEffects from all 8 starter activities (only needEffects remain)

**ActivityStore.ts:**
- Removed `threshold` case from isActivityComplete()
- Removed `threshold` case from estimateActivityDuration()

**Impact:** Clean type system with only v1.1 needs/action resources. Activities now only restore needs during execution.

### Bug Fix: Remove dead resourceEffects preview from ActivityCard

**Commit:** `042985c`

**Changes:**
- Removed effectsPreview calculation (referenced deleted activity.resourceEffects)
- Removed resource effects preview section from UI
- Resource costs are already shown, need effects apply during execution

**Rationale:** This was broken code discovered during final verification. Applied Rule 1 deviation (auto-fix bugs).

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed broken ActivityCard component**

- **Found during:** Final verification grep for resourceEffects
- **Issue:** ActivityCard.tsx line 64 tried to access `activity.resourceEffects` which was removed in Task 3
- **Fix:** Removed effectsPreview calculation and preview section entirely (dead code)
- **Files modified:** src/components/ActivityCard.tsx
- **Commit:** `042985c`

This was the only deviation. No architectural decisions needed.

## Verification Results

All success criteria met:

✅ TypeScript compiles with no errors (`npx tsc --noEmit`)
✅ No `needsSystemEnabled` references in src/
✅ No `Resources` type export in types.ts
✅ No `resourceEffects` references in src/
✅ No `BASE_DRAIN_RATES` or `BASE_RECOVERY_RATES` in src/
✅ Character properties (needs, derivedStats, actionResources) are required
✅ Constructor initializes v1.1 system immediately
✅ Activities only have needEffects, not resourceEffects

## Architectural Impact

**Before:**
- Character had optional v1.1 properties (needs?, derivedStats?, actionResources?)
- RootStore toggle controlled which system ran
- ActivityStore had v1.0/v1.1 fallback branches
- Activities had both resourceEffects and needEffects
- Types included both Resources and Needs systems

**After:**
- Character has required v1.1 properties (needs, derivedStats, actionResources)
- No toggle - v1.1 system always runs
- ActivityStore only uses v1.1 action resources
- Activities only have needEffects
- Types only include v1.1 Needs/DerivedStats/ActionResources

**Breaking Changes:**
- Saved character data with `resources` field will need migration (handled via optional needs field)
- Any code expecting optional Character properties will fail (good - forces cleanup)
- threshold DurationMode variant removed (no activities used it)

## Technical Debt Resolved

- ✅ Removed dual system complexity (toggle branches)
- ✅ Removed unused v1.0 constants and helper methods
- ✅ Removed optional property guards throughout Character
- ✅ Simplified duration mode types (removed unused variant)
- ✅ Removed dead UI code (resourceEffects preview)

## Next Phase Readiness

**Phase 10.1-03 (Remove v1.0 UI Components):**
- Ready to remove ResourcePanel dependencies (already deleted in 10.1-01)
- Ready to remove any remaining v1.0 visualization code
- All data model cleanup complete

**No blockers identified.**

## Code Quality Metrics

- **Lines removed:** ~450 (across 7 files)
- **Lines added:** ~30 (constructor initialization, type updates)
- **Net reduction:** ~420 lines
- **Complexity reduction:** Removed 5 computed getters, 3 helper methods, dual-system branching
- **Type safety improvement:** Made optional properties required, eliminated nullable chains

## Team Notes

The v1.0 resource system is now completely removed from the codebase. The v1.1 needs/action resources system is the only system, fully required and always initialized.

Key architectural win: Character entity went from 1218 lines to 965 lines (253 line reduction, 21% smaller) by removing v1.0 infrastructure.

All TypeScript errors from Plan 01 are now resolved.
