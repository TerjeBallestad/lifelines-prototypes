---
phase: 12-tuning-balance
plan: 04
type: execute
wave: 3
depends_on: ["12-03"]
files_modified:
  - src/components/SimulationRunnerPanel.tsx
  - src/components/TelemetryChartsPanel.tsx
  - src/components/CharacterPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Player can start a headless 7-day simulation"
    - "Player can see progress during simulation"
    - "Player can view time-series charts of needs over simulated time"
    - "Player can compare introvert vs extrovert simulation results"
  artifacts:
    - path: "src/components/SimulationRunnerPanel.tsx"
      provides: "UI controls for headless simulation"
      min_lines: 80
    - path: "src/components/TelemetryChartsPanel.tsx"
      provides: "Recharts visualization of telemetry data"
      min_lines: 100
  key_links:
    - from: "src/components/SimulationRunnerPanel.tsx"
      to: "src/utils/headlessSimulation.ts"
      via: "runHeadlessSimulation call"
      pattern: "runHeadlessSimulation"
    - from: "src/components/TelemetryChartsPanel.tsx"
      to: "src/stores/TelemetryStore.ts"
      via: "MobX observer reading runs"
      pattern: "telemetryStore\\.runs"
---

<objective>
Create UI for running headless simulations and visualizing telemetry results with Recharts.

Purpose: Enables player/designer to run 7-day validation tests and see time-series charts of needs/stats, comparing personality types.
Output: SimulationRunnerPanel for test controls, TelemetryChartsPanel with Recharts LineChart.
</objective>

<execution_context>
@/Users/godstemning/.claude/get-shit-done/workflows/execute-plan.md
@/Users/godstemning/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-tuning-balance/12-CONTEXT.md
@.planning/phases/12-tuning-balance/12-RESEARCH.md

# Dependencies from prior plans
@src/stores/TelemetryStore.ts (from 12-03)
@src/utils/headlessSimulation.ts (from 12-03)

# Existing patterns
@src/components/DevToolsPanel.tsx (collapsible panel pattern)
@src/components/DecisionLogPanel.tsx (expandable details pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SimulationRunnerPanel</name>
  <files>src/components/SimulationRunnerPanel.tsx</files>
  <action>
Create SimulationRunnerPanel for headless simulation controls:

1. Use DaisyUI collapse pattern (collapsible panel)
2. Controls:
   - Duration dropdown: "1 day", "3 days", "7 days" (1440, 4320, 10080 ticks)
   - Personality preset buttons: "Introvert" (extraversion: 20), "Extrovert" (extraversion: 80), "Current"
   - Sample rate dropdown: "Every tick", "Every 10 ticks", "Every 60 ticks"
   - "Run Simulation" button
   - "Run Comparison" button (runs introvert + extrovert side by side)
3. Progress indicator:
   - Show "Running... X/Y ticks" while simulation in progress
   - Use React state: isRunning, progress (0-100%)
4. Results summary after completion:
   - Survival rate %
   - Min need values
   - Avg mood
   - Critical events count

```typescript
import { useState } from 'react';
import { observer } from 'mobx-react-lite';
import { useRootStore } from '../stores/RootStore';
import { runHeadlessSimulation, SEVEN_DAYS_TICKS, DEFAULT_SAMPLE_RATE } from '../utils/headlessSimulation';

const DURATIONS = {
  '1 day': 1440,
  '3 days': 4320,
  '7 days': 10080,
} as const;

const PERSONALITIES = {
  'Introvert': { extraversion: 20 },
  'Extrovert': { extraversion: 80 },
  'Current': undefined,
} as const;
```

Wire "Run Simulation" to call runHeadlessSimulation with selected options.
Wire "Run Comparison" to run two simulations sequentially (introvert then extrovert).
  </action>
  <verify>File exists and exports SimulationRunnerPanel. TypeScript compiles.</verify>
  <done>SimulationRunnerPanel provides controls for running headless simulations with personality presets.</done>
</task>

<task type="auto">
  <name>Task 2: Create TelemetryChartsPanel</name>
  <files>src/components/TelemetryChartsPanel.tsx</files>
  <action>
Create TelemetryChartsPanel for visualizing simulation results with Recharts:

1. Use DaisyUI collapse pattern (collapsible panel)
2. Show list of completed runs with basic stats
3. For selected run, display:
   - Primary Needs chart (7 lines: hunger, energy, hygiene, bladder, social, fun, security)
   - Derived Stats chart (3 lines: mood, purpose, nutrition)
   - Action Resources chart (4 lines: overskudd, socialBattery, focus, willpower)
4. Use Recharts components:
   - LineChart with CartesianGrid, XAxis, YAxis, Tooltip, Legend
   - Each Line with type="monotone" and distinct stroke colors
   - XAxis shows tick number, YAxis domain [0, 100]
5. Comparison mode:
   - When 2 runs selected, show side-by-side charts
   - Or overlay with different line styles (solid vs dashed)

```typescript
import { observer } from 'mobx-react-lite';
import { useState } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import { useRootStore } from '../stores/RootStore';

// Color scheme for needs
const NEED_COLORS = {
  hunger: '#ff7300',
  energy: '#387908',
  hygiene: '#8884d8',
  bladder: '#82ca9d',
  social: '#ffc658',
  fun: '#ff6b6b',
  security: '#4ecdc4',
};
```

Performance note: For large datasets (10k+ points), downsample to every 10th or 100th point for chart rendering per RESEARCH.md pitfall.
  </action>
  <verify>File exists and exports TelemetryChartsPanel. Recharts import works. TypeScript compiles.</verify>
  <done>TelemetryChartsPanel displays time-series Recharts of simulation telemetry with run selection.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate panels into CharacterPanel</name>
  <files>src/components/CharacterPanel.tsx</files>
  <action>
Add SimulationRunnerPanel and TelemetryChartsPanel to CharacterPanel:

1. Import both new components
2. Add them in a "Balance Testing" collapsible section, after existing debug tools
3. Order: SimulationRunnerPanel, then TelemetryChartsPanel below it
4. Only render when character exists (same pattern as other panels)

Layout suggestion: Use a `<details>` wrapper for "Balance Testing Tools" that contains both panels nested inside.

```tsx
<details className="collapse collapse-arrow bg-base-200 rounded-box mt-2">
  <summary className="collapse-title text-sm font-medium">
    Balance Testing Tools
  </summary>
  <div className="collapse-content space-y-2">
    <SimulationRunnerPanel />
    <TelemetryChartsPanel />
  </div>
</details>
```
  </action>
  <verify>`npm run build` succeeds. Panels visible in CharacterPanel when expanded.</verify>
  <done>SimulationRunnerPanel and TelemetryChartsPanel accessible in CharacterPanel UI.</done>
</task>

</tasks>

<verification>
- "Run Simulation" starts headless simulation, shows progress
- Simulation completes without freezing UI
- Results summary shows survival rate, min needs, avg mood
- TelemetryChartsPanel shows line charts with needs over time
- "Run Comparison" runs introvert + extrovert and both appear in charts panel
- Charts handle large datasets without performance issues (downsampling works)
</verification>

<success_criteria>
- Player can run 7-day headless simulation via UI
- Progress visible during simulation run
- Time-series charts display needs, derived stats, action resources over simulated time
- Comparison between introvert and extrovert runs visible in charts
</success_criteria>

<output>
After completion, create `.planning/phases/12-tuning-balance/12-04-SUMMARY.md`
</output>
