---
phase: 10-activity-need-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/entities/types.ts
  - src/utils/personalityFit.ts
autonomous: true

must_haves:
  truths:
    - "Activities can define tags for personality alignment matching"
    - "Activities can define need restoration effects"
    - "Personality alignment produces cost/gain multipliers in 0.6-1.4 range"
  artifacts:
    - path: "src/entities/types.ts"
      provides: "ActivityData.tags and ActivityData.needEffects fields"
      contains: "tags?: string[]"
    - path: "src/utils/personalityFit.ts"
      provides: "calculatePersonalityAlignment function"
      exports: ["calculatePersonalityAlignment", "ActivityAlignment"]
  key_links:
    - from: "src/utils/personalityFit.ts"
      to: "Activity tags"
      via: "tag-based alignment calculation"
      pattern: "tags.*includes"
---

<objective>
Add activity tagging system and personality alignment calculation utility.

Purpose: Enable activities to declare their personality alignment via tags, and provide a utility to calculate cost/gain modifiers based on Big Five trait matching.

Output: Extended ActivityData type with tags and needEffects, plus personalityFit.ts utility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-activity-need-integration/10-CONTEXT.md
@.planning/phases/10-activity-need-integration/10-RESEARCH.md

@src/entities/types.ts
@src/entities/Activity.ts
@src/entities/Character.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend ActivityData with tags and needEffects</name>
  <files>src/entities/types.ts</files>
  <action>
Add two new optional fields to the ActivityData interface:

1. `tags?: string[]` - Array of personality alignment tags
   - Tags: 'social', 'solo', 'routine', 'creative', 'cooperative', 'stressful', 'concentration'
   - An activity can have multiple tags (e.g., 'social' + 'cooperative')

2. `needEffects?: Partial<Record<NeedKey, number>>` - Per-tick need restoration
   - Positive values restore needs (e.g., hunger: 5 restores 5 hunger per tick)
   - Can affect multiple needs simultaneously
   - Applied in ActivityStore alongside existing resourceEffects

Add a doc comment explaining that needEffects applies gradually during activity execution, not on completion.

Do NOT add default values for these fields - they are optional and undefined is valid.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>ActivityData has tags?: string[] and needEffects?: Partial&lt;Record&lt;NeedKey, number&gt;&gt; fields</done>
</task>

<task type="auto">
  <name>Task 2: Create personality alignment utility</name>
  <files>src/utils/personalityFit.ts</files>
  <action>
Create a new utility file for personality alignment calculations.

Export interface:
```typescript
export interface ActivityAlignment {
  costMultiplier: number;   // 0.6-1.4 range (aligned = lower cost)
  gainMultiplier: number;   // 0.6-1.4 range (aligned = higher gain)
  breakdown: Array<{ trait: string; contribution: number }>;
}
```

Export function:
```typescript
export function calculatePersonalityAlignment(
  tags: string[] | undefined,
  personality: Personality
): ActivityAlignment
```

Implementation rules (from CONTEXT.md):
- All Big Five traits affect relevant activities:
  - Extraversion: 'social' (extroverts benefit) vs 'solo' (introverts benefit)
  - Openness: 'creative' activities
  - Conscientiousness: 'routine' activities
  - Agreeableness: 'cooperative' activities
  - Neuroticism: 'stressful' activities (high neuroticism = penalty)
- Modifier strength 25-40% (clamp to 0.6-1.4)
- Trait contribution formula: (trait - 50) / 100 * 0.3 for aligned tags
- For inverse tags (solo vs social), apply opposite direction
- Return 1.0/1.0 if no tags or no matching traits

Example:
- Activity with ['social'] tag, character with extraversion 80
- Contribution: (80 - 50) / 100 * 0.3 = 0.09
- costMultiplier = 1.0 - 0.09 = 0.91 (9% cheaper)
- gainMultiplier = 1.0 + 0.09 = 1.09 (9% more restoration)

Include JSDoc comments explaining the alignment system.
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. File exists with exports: `grep -l "calculatePersonalityAlignment" src/utils/personalityFit.ts`
  </verify>
  <done>personalityFit.ts exports calculatePersonalityAlignment function that produces ActivityAlignment with cost/gain multipliers based on Big Five traits</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. ActivityData interface includes tags and needEffects fields
3. personalityFit.ts exports calculatePersonalityAlignment and ActivityAlignment
4. Alignment multipliers are correctly clamped to 0.6-1.4 range
</verification>

<success_criteria>
- ActivityData type extended with optional tags and needEffects
- calculatePersonalityAlignment utility implemented with Big Five trait mapping
- All code compiles without TypeScript errors
- Ready for Plan 02 to use alignment in Activity.getResourceCosts
</success_criteria>

<output>
After completion, create `.planning/phases/10-activity-need-integration/10-01-SUMMARY.md`
</output>
