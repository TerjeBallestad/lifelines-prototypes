---
phase: 03-skills-system
plan: 04
type: execute
wave: 3
depends_on: ["03-03"]
files_modified:
  - src/components/SkillTreePanel.tsx
  - src/components/SkillCard.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "User can see skills organized by domain tabs"
    - "Skill cards show level, state (locked/unlockable/unlocked/mastered)"
    - "Locked skills show WHY they are locked (prerequisite progress)"
    - "User can unlock skill levels by spending domain XP"
    - "Domain XP balance is visible per tab"
  artifacts:
    - path: "src/components/SkillTreePanel.tsx"
      provides: "Domain tabs with skill grid and XP display"
      exports: ["SkillTreePanel"]
      min_lines: 50
    - path: "src/components/SkillCard.tsx"
      provides: "Individual skill display with state, level, prerequisites, unlock button"
      exports: ["SkillCard"]
      min_lines: 60
    - path: "src/App.tsx"
      provides: "App with SkillTreePanel in main content area"
      contains: "SkillTreePanel"
  key_links:
    - from: "src/components/SkillTreePanel.tsx"
      to: "src/stores/index.tsx"
      via: "useSkillStore hook"
      pattern: "useSkillStore\\(\\)"
    - from: "src/components/SkillCard.tsx"
      to: "src/stores/index.tsx"
      via: "useSkillStore for state and actions"
      pattern: "useSkillStore\\(\\)"
    - from: "src/App.tsx"
      to: "src/components/SkillTreePanel.tsx"
      via: "renders SkillTreePanel"
      pattern: "<SkillTreePanel"
---

<objective>
Create skill visualization with domain tabs, skill cards showing state and prerequisites, and unlock interaction.

Purpose: Make the skill system visible and interactive, fulfilling all Phase 3 success criteria.
Output: SkillTreePanel with tabs, SkillCard with state display and unlock button, integrated into App
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-skills-system/03-CONTEXT.md
@.planning/phases/03-skills-system/03-RESEARCH.md
@.planning/phases/03-skills-system/03-01-SUMMARY.md
@.planning/phases/03-skills-system/03-02-SUMMARY.md
@.planning/phases/03-skills-system/03-03-SUMMARY.md

# Existing UI patterns
@src/components/CharacterPanel.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SkillCard component</name>
  <files>src/components/SkillCard.tsx</files>
  <action>
Create src/components/SkillCard.tsx:

1. Imports:
   - { observer } from 'mobx-react-lite'
   - { useSkillStore } from '../stores'
   - type { SkillState, PrerequisiteStatus } from '../entities/types'

2. Props interface:
   - skillId: string

3. State-based styling (from RESEARCH.md):
   const stateStyles: Record<SkillState, string> = {
     locked: 'opacity-50 grayscale',
     unlockable: 'ring-2 ring-primary',
     unlocked: '',
     mastered: 'ring-2 ring-accent bg-accent/10',
   };
   const stateIcons: Record<SkillState, string> = {
     locked: 'lock',
     unlockable: 'lock-open',
     unlocked: '',
     mastered: 'star',
   };

4. Component (observer wrapped):
   - Get skillStore via useSkillStore()
   - Get skill = skillStore.getSkill(skillId), return null if not found
   - Get state = skillStore.getSkillState(skillId)
   - Get canAfford = skillStore.canAffordUnlock(skillId)
   - Get prerequisites = skillStore.getPrerequisiteProgress(skillId)

5. Render DaisyUI card with:
   - Card container: className={`card bg-base-200 ${stateStyles[state]}`}
   - Card body:
     - Header row: skill.name + level badge ("Lv.{skill.level}" or "Lv.0" for locked)
     - State icon if locked/unlockable/mastered (use DaisyUI heroicons or emoji fallback)
     - Description: skill.description (text-sm, text-base-content/70)

   - If state === 'locked': show prerequisite progress section
     - "Prerequisites:" heading
     - For each prereq in prerequisites:
       - "{prereq.name}: {prereq.met ? 'check-circle' : `Lv.${prereq.current}/${prereq.required}`}"
       - Green checkmark if met, warning color if not met

   - If state === 'locked' or state === 'unlockable' or (state === 'unlocked' && skill.level < 5):
     - Show "Unlock Lv.{skill.level + 1}" button
     - Cost display: "{skill.nextLevelCost} XP"
     - Button disabled if !canAfford OR (state === 'locked' && !skillStore.isUnlockable(skillId))
     - onClick: skillStore.unlockSkillLevel(skillId)

6. Export as named export: export const SkillCard = observer(function SkillCard(...))
  </action>
  <verify>`npx tsc --noEmit` compiles</verify>
  <done>SkillCard displays skill with level badge, state styling, prerequisite progress for locked skills, and unlock button</done>
</task>

<task type="auto">
  <name>Task 2: Create SkillTreePanel with domain tabs</name>
  <files>src/components/SkillTreePanel.tsx</files>
  <action>
Create src/components/SkillTreePanel.tsx:

1. Imports:
   - { useState } from 'react'
   - { observer } from 'mobx-react-lite'
   - { useSkillStore } from '../stores'
   - { SkillCard } from './SkillCard'
   - type { SkillDomain } from '../entities/types'

2. Define DOMAINS array: const DOMAINS: SkillDomain[] = ['social', 'organisational', 'analytical', 'physical', 'creative']

3. Domain display names (optional, for nicer UI):
   const DOMAIN_LABELS: Record<SkillDomain, string> = {
     social: 'Social',
     organisational: 'Organisation',
     analytical: 'Analytical',
     physical: 'Physical',
     creative: 'Creative',
   };

4. Component (observer wrapped):
   - const [activeDomain, setActiveDomain] = useState<SkillDomain>('social')
   - Get skillStore via useSkillStore()
   - Get skills for active domain: skillStore.skillsByDomain(activeDomain)
   - Get XP for active domain: skillStore.domainXP.get(activeDomain) || 0

5. Render:
   - Container: className="p-4"
   - Header: "Skill Tree" (text-xl, font-bold)

   - Tabs (DaisyUI tabs-box):
     <div role="tablist" className="tabs tabs-box mb-4">
       {DOMAINS.map(domain => (
         <button
           key={domain}
           role="tab"
           className={`tab ${activeDomain === domain ? 'tab-active' : ''}`}
           onClick={() => setActiveDomain(domain)}
         >
           {DOMAIN_LABELS[domain]}
           <span className="badge badge-sm ml-2">
             {skillStore.domainXP.get(domain) || 0} XP
           </span>
         </button>
       ))}
     </div>

   - Domain XP display (larger, more prominent):
     <div className="mb-4 text-lg">
       <span className="font-semibold">{DOMAIN_LABELS[activeDomain]} XP:</span>
       <span className="ml-2 text-primary font-bold">{skillStore.domainXP.get(activeDomain) || 0}</span>
     </div>

   - Skill grid:
     <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
       {skills.map(skill => (
         <SkillCard key={skill.id} skillId={skill.id} />
       ))}
     </div>

   - If no skills in domain: show "No skills in this domain yet" message

6. Export: export const SkillTreePanel = observer(function SkillTreePanel() {...})
  </action>
  <verify>`npx tsc --noEmit` compiles</verify>
  <done>SkillTreePanel shows domain tabs with XP badges, skill grid for active domain</done>
</task>

<task type="auto">
  <name>Task 3: Integrate SkillTreePanel into App</name>
  <files>src/App.tsx</files>
  <action>
Update src/App.tsx:

1. Import SkillTreePanel: import { SkillTreePanel } from './components/SkillTreePanel';

2. In the main content area (the flex-1 div that currently has SimulationControls):
   - Keep SimulationControls at the top
   - Add SkillTreePanel below it
   - Wrap in a container for better layout:

   <main className="flex-1 p-4 overflow-y-auto">
     <SimulationControls />
     <div className="mt-6">
       <SkillTreePanel />
     </div>
   </main>

The existing CharacterPanel sidebar remains unchanged.
  </action>
  <verify>
1. `npx tsc --noEmit` compiles
2. `npm run dev` starts and shows SkillTreePanel in main area
  </verify>
  <done>SkillTreePanel visible in App main content area alongside SimulationControls</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 3 skill system:
- 8 skills across 3 domains (social, organisational, physical)
- Domain tabs showing skills and XP balance
- Skill cards with level badges and state styling
- Locked skills show prerequisite progress ("Eye Contact: check, Make a List: Lv.0/1")
- Unlock button spends domain XP to level up skills
  </what-built>
  <how-to-verify>
1. Open http://localhost:5173 in browser
2. Verify SkillTreePanel appears below SimulationControls
3. Click through domain tabs (Social, Organisation, Physical)
4. Verify Social domain shows 3 skills, Organisation shows 2, Physical shows 3
5. Check locked skill styling (faded/grayscale)
6. Check unlockable skills have ring highlight
7. Verify "Go to Store" shows both prerequisites: "Go Outside" and "Make a List"
8. Try unlocking:
   - Click "Eye Contact" unlock button (costs 50 XP from 100 Social XP)
   - Verify XP decreases to 50 and skill shows Lv.1
   - Verify "Small Talk" becomes unlockable (ring highlight)
9. Try unlocking "Go to Store" (should stay locked until both Go Outside AND Make a List are unlocked)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. App runs: `npm run dev` without console errors
3. Phase 3 Success Criteria:
   - 5-8 skills in meaningful dependency tree (8 skills, 3 domains)
   - Skill states display correctly (locked/unlockable/unlocked/mastered styling)
   - Player sees WHY skill is locked (prerequisite progress shown)
   - Skills accumulate XP toward next state (level up via spending XP)
   - Skill tree renders with domain tabs
</verification>

<success_criteria>
- SkillTreePanel renders with 5 domain tabs
- Each tab shows XP balance and skills in that domain
- SkillCard shows skill name, level badge, description, state styling
- Locked skills show prerequisite progress list
- Unlock button works: deducts XP, increments level, updates UI
- All 8 skills visible across tabs
- Cross-domain dependency visible (Go to Store requires Go Outside + Make a List)
- Human verification passes all checks
</success_criteria>

<output>
After completion, create `.planning/phases/03-skills-system/03-04-SUMMARY.md`
</output>
