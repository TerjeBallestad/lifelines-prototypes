---
phase: 06-integration-observation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/config/balance.ts
  - src/stores/RootStore.ts
  - src/components/DevToolsPanel.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Balance parameters are centralized in typed config"
    - "Dev Tools panel exists with simulation speed + balance sliders"
    - "Reset to defaults restores all parameters"
  artifacts:
    - path: "src/config/balance.ts"
      provides: "Centralized balance configuration"
      exports: ["BalanceConfig", "BalanceConfigStore", "DEFAULT_BALANCE"]
    - path: "src/components/DevToolsPanel.tsx"
      provides: "Collapsible dev tools UI"
      exports: ["DevToolsPanel"]
  key_links:
    - from: "src/components/DevToolsPanel.tsx"
      to: "src/config/balance.ts"
      via: "useRootStore().balanceConfig"
      pattern: "balanceConfig\\."
    - from: "src/stores/RootStore.ts"
      to: "src/config/balance.ts"
      via: "import and instantiation"
      pattern: "BalanceConfigStore"
---

<objective>
Create balance configuration system and centralized Dev Tools panel.

Purpose: Centralize all game balance parameters for tuning, expose them in a single collapsible Dev Tools panel for experimentation.

Output:
- `src/config/balance.ts` with typed balance config and MobX store
- `src/components/DevToolsPanel.tsx` with collapsible dev tools UI
- Updated RootStore with balanceConfig
- DevToolsPanel integrated into App.tsx
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-integration-observation/06-CONTEXT.md
@.planning/phases/06-integration-observation/06-RESEARCH.md

@src/stores/RootStore.ts
@src/App.tsx
@src/entities/Character.ts (BASE_DRAIN_RATES, BASE_RECOVERY_RATES)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Balance configuration store</name>
  <files>src/config/balance.ts, src/stores/RootStore.ts</files>
  <action>
Create `src/config/balance.ts`:
1. Define `BalanceConfig` type with:
   - `minOverskuddToStart: number` (default: 20)
   - `masteryBonusPerLevel: number` (default: 0.05)
   - `masteryXPOnSuccess: number` (default: 10)
   - `masteryXPOnFailure: number` (default: 5)
   - `talentPickThreshold: number` (default: 500)
   - `maxPendingPicks: number` (default: 3)
   - `personalityModifierStrength: number` (default: 1.0)
   - `simulationTickMs: number` (default: 1000)

2. Export `DEFAULT_BALANCE: BalanceConfig` with all defaults

3. Create `BalanceConfigStore` class with:
   - `config: BalanceConfig` (observable)
   - `constructor()` initializes from DEFAULT_BALANCE
   - `makeAutoObservable(this)`
   - Getter for each config field (e.g., `get minOverskuddToStart()`)
   - `update(updates: Partial<BalanceConfig>): void` - validates and applies
   - `reset(): void` - resets to DEFAULT_BALANCE

4. Update `src/stores/RootStore.ts`:
   - Import BalanceConfigStore
   - Add `balanceConfig: BalanceConfigStore` field
   - Instantiate in constructor
   - Add `useBalanceConfig()` convenience hook

Note: For this prototype, balance config is a runtime-only MobX store. The actual drain/recovery rates in Character.ts will be wired to use this config in a later plan if needed - for now this just provides the UI and storage layer.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Imports resolve correctly
  </verify>
  <done>
BalanceConfigStore exists with typed config, RootStore exposes balanceConfig, useBalanceConfig hook available
  </done>
</task>

<task type="auto">
  <name>Task 2: Dev Tools panel component</name>
  <files>src/components/DevToolsPanel.tsx, src/App.tsx</files>
  <action>
Create `src/components/DevToolsPanel.tsx`:
1. Import observer, useRootStore (for simulationStore, balanceConfig)
2. Use native `<details>` with DaisyUI collapse classes:
   ```tsx
   <details className="collapse collapse-arrow bg-base-200 border border-base-300">
     <summary className="collapse-title text-lg font-medium">Dev Tools</summary>
     <div className="collapse-content">...</div>
   </details>
   ```

3. Inside collapse-content, organize sections:

   **Simulation section:**
   - Speed slider (0-10x) with current value display
   - Uses simulationStore.speed and setSpeed()

   **Balance Parameters section:**
   - Use `<div className="divider text-sm">Balance</div>` separator
   - Grid of number inputs for balance config fields
   - Each input: label + input, uses `balanceConfig.update({ field: value })`
   - Clamp values to non-negative on change

   **Reset button:**
   - `<button onClick={() => balanceConfig.reset()} className="btn btn-sm btn-outline btn-warning mt-4 w-full">Reset All to Defaults</button>`

4. Wrap component in `observer()`

5. Update `src/App.tsx`:
   - Import DevToolsPanel
   - Add `<DevToolsPanel />` at the bottom of main content area (after TalentsPanel)
  </action>
  <verify>
Run `npm run dev`, see DevToolsPanel collapsed at bottom of main area. Click to expand, see simulation speed slider and balance parameter inputs. Adjust values, see them update. Click Reset, see values return to defaults.
  </verify>
  <done>
DevToolsPanel renders with simulation controls and balance parameters. Values are reactive and Reset works.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run dev` starts without errors
3. DevToolsPanel visible and functional
4. Balance config values persist during session
5. Reset restores all defaults
</verification>

<success_criteria>
- BalanceConfigStore with typed config and reactive updates
- DevToolsPanel with collapsible UI containing all controls
- Reset to defaults works correctly
- All existing functionality unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/06-integration-observation/06-01-SUMMARY.md`
</output>
