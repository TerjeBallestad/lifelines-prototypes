---
phase: 09-action-resources
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/entities/types.ts
  - src/config/balance.ts
  - src/entities/Character.ts
autonomous: true

must_haves:
  truths:
    - "Overskudd value approaches computed target based on Mood, Energy, Purpose"
    - "socialBattery drains for introverts during social context, charges when solo"
    - "socialBattery charges for extroverts during social context, drains when solo"
    - "Willpower affects Overskudd recovery rate, not the target value"
  artifacts:
    - path: "src/entities/types.ts"
      provides: "ActionResources interface"
      contains: "interface ActionResources"
    - path: "src/config/balance.ts"
      provides: "ActionResourcesConfig with tuning constants"
      contains: "interface ActionResourcesConfig"
    - path: "src/entities/Character.ts"
      provides: "Action resources computed getters and tick update"
      contains: "applyActionResourcesUpdate"
  key_links:
    - from: "src/entities/Character.ts"
      to: "src/config/balance.ts"
      via: "actionResourcesConfig access"
      pattern: "actionResourcesConfig"
    - from: "src/entities/Character.ts"
      to: "src/entities/types.ts"
      via: "ActionResources type import"
      pattern: "import.*ActionResources"
---

<objective>
Add ActionResources types, configuration, and Character integration for the four action resources (Overskudd, socialBattery, Focus, Willpower).

Purpose: Establish the foundation for resource-gated activities by computing action resources from needs, personality, and derived wellbeing.
Output: Character entity with computed action resource targets, smoothed updates, and breakdown getters for tooltip display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-action-resources/09-CONTEXT.md
@.planning/phases/09-action-resources/09-RESEARCH.md
@src/entities/types.ts
@src/config/balance.ts
@src/entities/Character.ts
@src/utils/smoothing.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ActionResources types and config</name>
  <files>src/entities/types.ts, src/config/balance.ts</files>
  <action>
In types.ts:
1. Add ActionResources interface with four fields (all 0-100 scale):
   - overskudd: number (computed from Mood + Energy + Purpose)
   - socialBattery: number (personality-inverted based on Extraversion)
   - focus: number (depleted by concentration activities)
   - willpower: number (depleted by difficult tasks)

2. Add SocialContext type: 0 | 1 | 2 (Solo, Social, Intense)

3. Add defaultActionResources() factory:
   - overskudd: 70 (start moderate, will adjust to computed target)
   - socialBattery: 70 (start moderate)
   - focus: 100 (start full)
   - willpower: 80 (start high)

4. Export ActionResources and SocialContext types

In balance.ts:
1. Add ActionResourcesConfig interface with:
   - Overskudd: overskuddAlpha (0.1), overskuddMoodWeight (0.4), overskuddEnergyWeight (0.35), overskuddPurposeWeight (0.25)
   - socialBattery: socialBatteryAlpha (0.08), introvertDrainRate (0.5), introvertChargeRate (0.3), extrovertDrainRate (0.4), extrovertChargeRate (0.4), ambivertDrainRate (0.1), zeroSocialBatteryWillpowerCost (20)
   - Focus: focusAlpha (0.1), focusRegenRate (0.2), focusCostPerTick (0.5)
   - Willpower: willpowerAlpha (0.08), willpowerRegenRate (0.15), willpowerFunBoost (0.3), willpowerDecisionCost (5)

2. Add DEFAULT_ACTION_RESOURCES_CONFIG with the values above

3. Add actionResources: ActionResourcesConfig to BalanceConfig interface

4. Add actionResources: DEFAULT_ACTION_RESOURCES_CONFIG to DEFAULT_BALANCE

5. Add actionResourcesConfig getter to BalanceConfigStore class
  </action>
  <verify>TypeScript compiles: `npm run build` passes with no type errors</verify>
  <done>ActionResources interface exists with 4 fields, ActionResourcesConfig exists with all tuning constants, BalanceConfig includes actionResources field</done>
</task>

<task type="auto">
  <name>Task 2: Add Character action resources logic</name>
  <files>src/entities/Character.ts</files>
  <action>
1. Add imports: ActionResources, defaultActionResources, SocialContext from types

2. Add properties to Character class:
   - actionResources?: ActionResources (optional, initialized via initializeActionResources)
   - private overskuddSmoother?: SmoothedValue
   - private socialBatterySmoother?: SmoothedValue
   - private focusSmoother?: SmoothedValue
   - private willpowerSmoother?: SmoothedValue
   - currentSocialContext: SocialContext = 0 (default to Solo)

3. Add initializeActionResources() method:
   - Guard: only if balance config is available
   - Set actionResources = defaultActionResources()
   - Initialize all four smoothers with config alphas
   - Call at end of initializeDerivedStats() to chain initialization

4. Add computed getters:
   - overskuddTarget: Weighted average of Mood (0.4) + Energy (0.35) + Purpose (0.25), clamped 0-100
   - overskuddBreakdown: StatBreakdown showing Mood, Energy, Purpose contributions
   - socialBatteryTarget: Based on Extraversion and currentSocialContext:
     * Introvert (E < 40): charges solo (100), drains social (20)
     * Extrovert (E > 60): drains solo (30), charges social (100)
     * Ambivert (40-60): neutral target (50) in both contexts
   - socialBatteryBreakdown: StatBreakdown showing personality effect
   - focusTarget: 100 (full when resting, depleted by activities)
   - focusBreakdown: StatBreakdown (simple for now)
   - willpowerTarget: 80 base, boosted by Fun need satisfaction
   - willpowerBreakdown: StatBreakdown

5. Add applyActionResourcesUpdate(speedMultiplier: number) method:
   - Guard: actionResources and config must be available
   - Update Overskudd: Use equilibrium pull with willpower-modified alpha
     * effectiveAlpha = config.overskuddAlpha * (0.5 + (willpower / 100) * 0.5)
     * This makes Overskudd recover faster when Willpower is high
   - Update socialBattery: Based on Extraversion + currentSocialContext
     * Compute drain/charge rate per tick
     * Apply via smoother
   - Update Focus: Passive regen toward target (activities will deplete in Phase 10)
   - Update Willpower: Passive regen toward target, boosted by Fun

6. Update applyTickUpdate() to call applyActionResourcesUpdate() after applyDerivedStatsUpdate()

7. Add spendFocus(amount: number) and spendWillpower(amount: number) methods for Phase 10
  </action>
  <verify>TypeScript compiles: `npm run build` passes. Open browser, enable v1.1 mode, verify console shows no errors when simulation runs.</verify>
  <done>Character has actionResources property initialized, computed targets respond to needs/personality, tick update modifies all four resources via smoothers</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` with no TypeScript errors
2. In browser with v1.1 enabled: `character.actionResources` shows all 4 values
3. Character with low Extraversion (30) shows socialBattery charging when no activity
4. Character with high Extraversion (70) shows socialBattery draining when no activity
5. Overskudd approaches target computed from Mood+Energy+Purpose over ticks
</verification>

<success_criteria>
- ActionResources interface exported from types.ts with 4 fields
- ActionResourcesConfig in balance.ts with all tuning constants
- Character.actionResources initialized when v1.1 mode enabled
- overskuddTarget computed getter uses Mood, Energy, Purpose with weights
- socialBattery drain/charge direction inverts based on Extraversion
- applyActionResourcesUpdate() called in tick loop when v1.1 enabled
- All breakdowns return StatBreakdown for UI tooltip display
</success_criteria>

<output>
After completion, create `.planning/phases/09-action-resources/09-01-SUMMARY.md`
</output>
