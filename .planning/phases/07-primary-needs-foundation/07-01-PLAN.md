---
phase: 07-primary-needs-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/entities/types.ts
  - src/config/balance.ts
  - src/entities/Character.ts
  - src/utils/needsDecay.ts
autonomous: true

must_haves:
  truths:
    - "Needs interface exists with 7 primary needs (Hunger, Energy, Hygiene, Bladder, Social, Fun, Security)"
    - "NeedsConfig exists with differential decay rates (physiological 3-4x faster than social)"
    - "Character can hold needs data and apply asymptotic decay each tick"
    - "Personality affects need decay rates (Extraversion -> Social, Neuroticism -> Security)"
  artifacts:
    - path: "src/entities/types.ts"
      provides: "Needs interface, NeedKey type, defaultNeeds()"
      contains: "interface Needs"
    - path: "src/config/balance.ts"
      provides: "NeedsConfig interface, DEFAULT_NEEDS_CONFIG"
      contains: "interface NeedsConfig"
    - path: "src/entities/Character.ts"
      provides: "needs property, applyNeedsDecay(), needsModifiers computed"
      contains: "applyNeedsDecay"
    - path: "src/utils/needsDecay.ts"
      provides: "applyAsymptoticDecay() utility function"
      exports: ["applyAsymptoticDecay"]
  key_links:
    - from: "src/entities/Character.ts"
      to: "src/utils/needsDecay.ts"
      via: "import applyAsymptoticDecay"
      pattern: "import.*applyAsymptoticDecay"
    - from: "src/entities/Character.ts"
      to: "src/config/balance.ts"
      via: "reads NeedsConfig from balanceConfig"
      pattern: "this\\.root\\?\\.balanceConfig"
---

<objective>
Establish the foundational types, configuration, and Character logic for the primary needs system.

Purpose: This plan creates the data layer for 7 primary needs with differential decay rates, enabling later phases to derive Mood, Purpose, and action resources from these needs. The asymptotic decay prevents death spirals while personality modifiers create emergence.

Output: Needs interface and types, NeedsConfig with tunable decay rates, Character.needs property with decay logic, utility for asymptotic decay calculations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-primary-needs-foundation/07-CONTEXT.md
@.planning/phases/07-primary-needs-foundation/07-RESEARCH.md
@src/entities/types.ts
@src/entities/Character.ts
@src/config/balance.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Needs Types and Config</name>
  <files>src/entities/types.ts, src/config/balance.ts</files>
  <action>
1. In `src/entities/types.ts`, add:
   - `Needs` interface with 7 number properties: hunger, energy, hygiene, bladder, social, fun, security (all 0-100 scale)
   - `NeedKey` type as `keyof Needs`
   - `defaultNeeds()` factory function returning starting values (hunger: 80, energy: 100, hygiene: 100, bladder: 100, social: 70, fun: 60, security: 50)
   - Place after existing Resources interface for logical grouping

2. In `src/config/balance.ts`, add:
   - `NeedsConfig` interface with:
     - Physiological decay rates (faster): hungerDecayRate, energyDecayRate, hygieneDecayRate, bladderDecayRate (suggest 0.7-1.0 range)
     - Social decay rates (slower, 3-4x): socialDecayRate, funDecayRate, securityDecayRate (suggest 0.15-0.3 range)
     - personalityModifierNeeds: number (multiplier for personality effects)
     - criticalThreshold: number (20 for urgent state)
   - `DEFAULT_NEEDS_CONFIG` constant with balanced defaults
   - Extend `BalanceConfig` interface to include `needs: NeedsConfig`
   - Update `DEFAULT_BALANCE` to include `needs: DEFAULT_NEEDS_CONFIG`
   - Add computed getter `needsConfig` to `BalanceConfigStore`

Keep existing Resource types unchanged - v1.0 and v1.1 systems will coexist.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Grep confirms types exist: `grep -n "interface Needs" src/entities/types.ts` and `grep -n "interface NeedsConfig" src/config/balance.ts`
  </verify>
  <done>
Needs interface has 7 properties (hunger, energy, hygiene, bladder, social, fun, security). NeedsConfig has differential decay rates with physiological rates 3-4x higher than social rates. BalanceConfig includes needs section.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Character Needs and Decay Logic</name>
  <files>src/utils/needsDecay.ts, src/entities/Character.ts</files>
  <action>
1. Create `src/utils/needsDecay.ts` with:
   ```typescript
   /**
    * Asymptotic decay: decay slows as value approaches floor.
    * Formula: newValue = currentValue - (baseRate * (currentValue - floor) / 100 * speedMultiplier)
    * This prevents instant bottoming-out while still allowing critical states.
    */
   export function applyAsymptoticDecay(
     currentValue: number,
     baseDecayRate: number,
     speedMultiplier: number,
     floor = 5  // Never quite reaches 0
   ): number {
     const distance = currentValue - floor;
     if (distance <= 0) return floor;
     const decayAmount = baseDecayRate * (distance / 100) * speedMultiplier;
     return Math.max(floor, currentValue - decayAmount);
   }
   ```

2. In `src/entities/Character.ts`:
   - Import `applyAsymptoticDecay` from utils
   - Import `Needs`, `NeedKey`, `defaultNeeds` from types
   - Add optional `needs?: Needs` property to Character class
   - Add `initializeNeeds(): void` method that sets `this.needs = defaultNeeds()`
   - Add computed `needsModifiers` getter that returns `Map<NeedKey, number>`:
     - High Extraversion (>60): faster Social decay (1 + scaled modifier)
     - High Neuroticism (>60): faster Security decay (1 + scaled modifier)
     - Use same scaling pattern as existing activeModifiers
   - Add `applyNeedsDecay(speedMultiplier: number): void` method:
     - Return early if `!this.needs || !this.root?.balanceConfig`
     - Get decay rates from `this.root.balanceConfig.config.needs`
     - Apply asymptotic decay to each need using personality modifiers from needsModifiers
     - Use pattern: `this.needs.hunger = applyAsymptoticDecay(this.needs.hunger, config.hungerDecayRate * modifier, speedMultiplier)`

DO NOT modify `applyTickUpdate()` yet - the toggle integration happens in Plan 02.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Grep confirms implementation: `grep -n "applyNeedsDecay" src/entities/Character.ts` and `grep -n "applyAsymptoticDecay" src/utils/needsDecay.ts`
  </verify>
  <done>
Character has needs property with initializeNeeds() method. applyNeedsDecay() applies asymptotic decay to all 7 needs using config rates and personality modifiers. Decay formula slows near floor value to prevent instant bottoming-out.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `grep -c "interface Needs" src/entities/types.ts` returns 1
3. `grep -c "interface NeedsConfig" src/config/balance.ts` returns 1
4. `grep -c "applyNeedsDecay" src/entities/Character.ts` returns at least 1
5. `grep -c "applyAsymptoticDecay" src/utils/needsDecay.ts` returns 1
</verification>

<success_criteria>
- Needs interface defines 7 primary needs with number types
- NeedsConfig has physiological rates (0.7-1.0) and social rates (0.15-0.3)
- Character.needs is optional property, initialized via initializeNeeds()
- applyNeedsDecay() uses asymptotic formula with personality modifiers
- All existing v1.0 code still works (no breaking changes)
</success_criteria>

<output>
After completion, create `.planning/phases/07-primary-needs-foundation/07-01-SUMMARY.md`
</output>
