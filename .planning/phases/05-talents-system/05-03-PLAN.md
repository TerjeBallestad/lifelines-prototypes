---
phase: 05-talents-system
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - src/components/TalentCard.tsx
  - src/components/TalentSelectionModal.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Modal appears when talent pick is available"
    - "Player sees 3 talent options with rarity indicators"
    - "Player can click to select one talent"
    - "Modal closes after selection and cannot be dismissed without selecting"
  artifacts:
    - path: "src/components/TalentCard.tsx"
      provides: "Single talent display with rarity and effects"
      exports: ["TalentCard"]
      min_lines: 30
    - path: "src/components/TalentSelectionModal.tsx"
      provides: "Pick-1-of-3 modal using native dialog"
      exports: ["TalentSelectionModal"]
      min_lines: 40
  key_links:
    - from: "src/components/TalentSelectionModal.tsx"
      to: "src/stores/TalentStore.ts"
      via: "useTalentStore hook"
      pattern: "useTalentStore"
    - from: "src/App.tsx"
      to: "src/components/TalentSelectionModal.tsx"
      via: "import and render"
      pattern: "TalentSelectionModal"
---

<objective>
Create the talent selection UI with modal and talent cards for the pick-1-of-3 roguelike experience.

Purpose: Enable players to see and select talents when picks are earned, using DaisyUI modal with native dialog element.
Output: TalentCard component, TalentSelectionModal component, integrated into App.tsx.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-talents-system/05-CONTEXT.md
@.planning/phases/05-talents-system/05-RESEARCH.md

@src/entities/Talent.ts
@src/stores/TalentStore.ts
@src/stores/RootStore.ts
@src/App.tsx
@src/components/ActivityCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TalentCard component</name>
  <files>src/components/TalentCard.tsx</files>
  <action>
Create new component following ActivityCard pattern, showing talent details with rarity styling:

```typescript
import { observer } from 'mobx-react-lite';
import type { Talent } from '../entities/Talent';

interface TalentCardProps {
  talent: Talent;
  onSelect?: () => void;
  compact?: boolean;
}

/**
 * Displays a single talent with rarity indicator and effects.
 * Used in selection modal and talents panel.
 */
export const TalentCard = observer(function TalentCard({
  talent,
  onSelect,
  compact = false,
}: TalentCardProps) {
  // Rarity badge styling
  const rarityBadgeClass: Record<string, string> = {
    common: 'badge-ghost',
    rare: 'badge-info',
    epic: 'badge-secondary',
  };

  // Rarity border glow
  const rarityBorderClass: Record<string, string> = {
    common: 'border-base-300',
    rare: 'border-info/50',
    epic: 'border-secondary/50 shadow-lg shadow-secondary/20',
  };

  return (
    <div
      className={`card bg-base-200 border-2 ${rarityBorderClass[talent.rarity]} ${
        onSelect ? 'cursor-pointer hover:bg-base-300 transition-colors' : ''
      } ${compact ? 'card-compact' : ''}`}
      onClick={onSelect}
    >
      <div className="card-body">
        {/* Header: Name + Rarity */}
        <div className="flex items-center justify-between">
          <h3 className={`card-title text-lg ${talent.rarityColorClass}`}>
            {talent.name}
          </h3>
          <span className={`badge ${rarityBadgeClass[talent.rarity]} capitalize`}>
            {talent.rarity}
          </span>
        </div>

        {/* Domain indicator */}
        {talent.domain && (
          <span className="badge badge-outline badge-sm capitalize">
            {talent.domain}
          </span>
        )}

        {/* Description */}
        <p className="text-sm opacity-80">{talent.description}</p>

        {/* Effects breakdown (only in non-compact mode) */}
        {!compact && talent.effects.length > 0 && (
          <div className="mt-2 space-y-1">
            <div className="text-xs font-semibold opacity-60 uppercase">Effects</div>
            {talent.effects.map((effect, idx) => (
              <div
                key={idx}
                className={`text-xs ${
                  effect.value > 0 ? 'text-success' : 'text-error'
                }`}
              >
                {effect.description}
              </div>
            ))}
          </div>
        )}

        {/* Select button (when interactive) */}
        {onSelect && (
          <div className="card-actions justify-end mt-2">
            <button className="btn btn-primary btn-sm">Select</button>
          </div>
        )}
      </div>
    </div>
  );
});
```
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>TalentCard component displays talent with rarity styling, effects list, and optional select action</done>
</task>

<task type="auto">
  <name>Task 2: Create TalentSelectionModal component</name>
  <files>src/components/TalentSelectionModal.tsx</files>
  <action>
Create modal using DaisyUI native dialog pattern per RESEARCH.md:

```typescript
import { observer } from 'mobx-react-lite';
import { useEffect, useRef } from 'react';
import { useTalentStore } from '../stores/RootStore';
import { TalentCard } from './TalentCard';

/**
 * Modal for picking 1 of 3 offered talents.
 * Uses native dialog element for accessibility.
 * Cannot be dismissed without making a selection.
 */
export const TalentSelectionModal = observer(function TalentSelectionModal() {
  const talentStore = useTalentStore();
  const dialogRef = useRef<HTMLDialogElement>(null);

  // Auto-open when offer becomes available
  useEffect(() => {
    if (talentStore.currentOffer && dialogRef.current && !dialogRef.current.open) {
      dialogRef.current.showModal();
    }
  }, [talentStore.currentOffer]);

  const handleSelect = (talentId: string) => {
    talentStore.selectTalent(talentId);
    dialogRef.current?.close();
  };

  // Prevent ESC key from closing modal
  const handleCancel = (e: React.SyntheticEvent) => {
    e.preventDefault();
  };

  if (!talentStore.currentOffer) return null;

  return (
    <dialog
      ref={dialogRef}
      className="modal"
      onCancel={handleCancel}
    >
      <div className="modal-box max-w-2xl">
        {/* Header */}
        <h3 className="font-bold text-xl mb-2">
          Choose a Talent
        </h3>

        {/* Pending picks indicator */}
        {talentStore.pendingPicks > 1 && (
          <div className="alert alert-info mb-4">
            <span>
              You have {talentStore.pendingPicks} talent picks available!
            </span>
          </div>
        )}

        {/* Vertical stacked cards per CONTEXT.md decision */}
        <div className="flex flex-col gap-4">
          {talentStore.currentOffer.map((talent) => (
            <TalentCard
              key={talent.id}
              talent={talent}
              onSelect={() => handleSelect(talent.id)}
            />
          ))}
        </div>

        {/* Info text */}
        <p className="text-sm opacity-60 mt-4 text-center">
          Talents are permanent. Choose wisely!
        </p>
      </div>

      {/* Modal backdrop - clicking doesn't close (must select) */}
      <div className="modal-backdrop bg-black/50" />
    </dialog>
  );
});
```
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>TalentSelectionModal opens on currentOffer, shows 3 talents, closes on selection, cannot be dismissed</done>
</task>

<task type="auto">
  <name>Task 3: Integrate modal into App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Add TalentSelectionModal to App.tsx:

1. Add import at top:
```typescript
import { TalentSelectionModal } from './components/TalentSelectionModal';
```

2. Add component inside the main div, after Toaster:
```typescript
<div className="flex min-h-screen bg-base-100">
  <Toaster position="bottom-right" richColors />
  <TalentSelectionModal />  {/* ADD THIS LINE */}
  {/* Sidebar */}
  <CharacterPanel />
  ...
</div>
```

The modal will automatically show when talentStore.currentOffer is populated (triggered by domain XP milestones).
  </action>
  <verify>`npm run dev` starts; earning 500 domain XP shows talent selection modal</verify>
  <done>TalentSelectionModal renders in App, appears when talent pick earned</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` completes without errors
2. `npm run dev` starts without errors
3. Browser console: `rootStore.talentStore.forceOffer()` shows modal
4. Modal displays 3 talents with rarity indicators
5. Clicking a talent's "Select" button selects it and closes modal
6. ESC key does not close modal
</verification>

<success_criteria>
- Modal appears when currentOffer exists
- 3 talents displayed in vertical stack
- Rarity badges show (common/rare/epic with color coding)
- Effect descriptions visible on each card
- Selection closes modal and adds talent to selectedTalents
- Multiple pending picks show alert badge
</success_criteria>

<output>
After completion, create `.planning/phases/05-talents-system/05-03-SUMMARY.md`
</output>
