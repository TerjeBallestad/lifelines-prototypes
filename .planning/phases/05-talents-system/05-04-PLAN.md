---
phase: 05-talents-system
plan: 04
type: execute
wave: 4
depends_on: ["05-03"]
files_modified:
  - src/components/TalentsPanel.tsx
  - src/entities/Character.ts
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "TalentsPanel shows all selected talents"
    - "Talent effects visibly modify character stats"
    - "Stat breakdowns show base + talent modifiers"
    - "Player can observe talent effects in gameplay"
  artifacts:
    - path: "src/components/TalentsPanel.tsx"
      provides: "Selected talents display with stat breakdowns"
      exports: ["TalentsPanel"]
      min_lines: 40
    - path: "src/entities/Character.ts"
      provides: "Talent modifier integration"
      contains: "talentStore"
  key_links:
    - from: "src/entities/Character.ts"
      to: "src/stores/TalentStore.ts"
      via: "root.talentStore access"
      pattern: "root.talentStore"
    - from: "src/components/TalentsPanel.tsx"
      to: "src/stores/TalentStore.ts"
      via: "useTalentStore hook"
      pattern: "useTalentStore"
---

<objective>
Create TalentsPanel to display selected talents and integrate talent effects into character stats.

Purpose: Make talents visibly affect gameplay by modifying resource drain rates and showing stat breakdowns.
Output: TalentsPanel component, Character.ts extended with talent modifiers, human verification of effects.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-talents-system/05-CONTEXT.md
@.planning/phases/05-talents-system/05-RESEARCH.md

@src/entities/Character.ts
@src/stores/TalentStore.ts
@src/stores/RootStore.ts
@src/App.tsx
@src/components/TalentCard.tsx
@src/components/CharacterPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TalentsPanel component</name>
  <files>src/components/TalentsPanel.tsx</files>
  <action>
Create panel showing selected talents following CharacterPanel patterns:

```typescript
import { observer } from 'mobx-react-lite';
import { useTalentStore } from '../stores/RootStore';
import { TalentCard } from './TalentCard';

/**
 * Panel displaying all selected talents with their effects.
 * Shows in main content area alongside skills and activities.
 */
export const TalentsPanel = observer(function TalentsPanel() {
  const talentStore = useTalentStore();
  const selectedTalents = talentStore.selectedTalentsArray;

  return (
    <div className="card bg-base-200 shadow-lg">
      <div className="card-body">
        {/* Header with count */}
        <div className="flex items-center justify-between">
          <h2 className="card-title">Talents</h2>
          <span className="badge badge-neutral">
            {selectedTalents.length} selected
          </span>
        </div>

        {/* Empty state */}
        {selectedTalents.length === 0 && (
          <div className="text-center py-8 opacity-60">
            <p>No talents selected yet.</p>
            <p className="text-sm mt-2">
              Earn 500 domain XP to unlock talent picks!
            </p>
          </div>
        )}

        {/* Selected talents list */}
        {selectedTalents.length > 0 && (
          <div className="space-y-3 mt-2">
            {selectedTalents.map((talent) => (
              <TalentCard key={talent.id} talent={talent} compact />
            ))}
          </div>
        )}

        {/* Pending picks indicator */}
        {talentStore.pendingPicks > 0 && (
          <div className="alert alert-warning mt-4">
            <span>
              {talentStore.pendingPicks} talent pick{talentStore.pendingPicks > 1 ? 's' : ''} available!
            </span>
            <button
              className="btn btn-sm btn-primary"
              onClick={() => talentStore.generateOffer()}
            >
              Choose
            </button>
          </div>
        )}

        {/* Dev: Force offer button (for testing) */}
        {import.meta.env.DEV && selectedTalents.length < talentStore.talentsArray.length - 2 && (
          <details className="mt-4">
            <summary className="cursor-pointer text-sm opacity-60">Dev Tools</summary>
            <button
              className="btn btn-xs btn-outline mt-2"
              onClick={() => talentStore.forceOffer()}
            >
              Force Talent Offer
            </button>
          </details>
        )}
      </div>
    </div>
  );
});
```
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>TalentsPanel displays selected talents, shows pending picks alert, has dev testing button</done>
</task>

<task type="auto">
  <name>Task 2: Integrate talent modifiers into Character</name>
  <files>src/entities/Character.ts</files>
  <action>
Extend Character's activeModifiers to include talent effects. The Character needs access to RootStore.

1. Add RootStore reference to Character constructor:

First, update the constructor to accept root store:
```typescript
import { type RootStore } from '../stores/RootStore';

// Add private root property
private root?: RootStore;

// Update constructor (add optional root parameter)
constructor(data: CharacterData, root?: RootStore) {
  this.id = data.id;
  this.name = data.name;
  this.personality = data.personality;
  this.capacities = data.capacities;
  this.resources = data.resources;
  this.root = root;

  makeAutoObservable(this);
}

// Add setter for root (called by CharacterStore after construction)
setRootStore(root: RootStore): void {
  this.root = root;
}
```

2. Extend activeModifiers getter to include talent effects:

At the end of the activeModifiers getter, before `return modifiers;`, add:

```typescript
// Add talent modifiers for resources
if (this.root?.talentStore) {
  const talents = this.root.talentStore.selectedTalentsArray;
  for (const talent of talents) {
    for (const effect of talent.effects) {
      // Only apply resource modifiers here (percentage type for drain/recovery)
      if (effect.target === 'resource' && effect.type === 'percentage') {
        modifiers.push({
          resourceKey: effect.targetKey as ResourceKey,
          source: talent.name,
          drainModifier: effect.value, // positive = faster drain, negative = slower
          recoveryModifier: 0,
        });
      }
    }
  }
}
```

3. Update CharacterStore to pass root and call setRootStore:

In CharacterStore.createCharacter, after creating the character:
```typescript
// After: this.character = new Character(characterData);
this.character?.setRootStore(this.root);
```

Note: The capacity effects (flat bonuses) will be handled in a computed getter that returns effective capacities. For this plan, focus on resource drain effects.
  </action>
  <verify>`npx tsc --noEmit` passes; `npm run dev` starts without errors</verify>
  <done>Character's activeModifiers includes talent effects for resource drain modifications</done>
</task>

<task type="auto">
  <name>Task 3: Add TalentsPanel to App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Add TalentsPanel to main content area:

1. Add import:
```typescript
import { TalentsPanel } from './components/TalentsPanel';
```

2. Add component after ActivityPanel in main content:
```typescript
<div className="mt-6">
  <ActivityPanel />
</div>
<div className="mt-6">
  <TalentsPanel />
</div>
```

The TalentsPanel will show below ActivityPanel in the main content area.
  </action>
  <verify>`npm run dev` shows TalentsPanel in UI</verify>
  <done>TalentsPanel visible in main content area below ActivityPanel</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete talent system with:
- Pick-1-of-3 selection modal
- Selected talents display in TalentsPanel
- Talent effects modify resource drain rates
  </what-built>
  <how-to-verify>
1. Open browser at http://localhost:5173
2. In TalentsPanel, expand "Dev Tools" and click "Force Talent Offer"
3. Verify modal appears with 3 talents showing rarity (colors/badges)
4. Select a talent (e.g., "Iron Will" for stress reduction)
5. Verify modal closes and talent appears in TalentsPanel
6. Start simulation and observe resources
7. If you selected a drain modifier talent, compare drain rate vs before

Alternative verification:
- Open browser console
- Run: `rootStore.talentStore.forceOffer()`
- Select talent in modal
- Run: `rootStore.talentStore.selectedTalentsArray` to verify selection
- Run: `rootStore.characterStore.character.activeModifiers` to see talent effects included
  </how-to-verify>
  <resume-signal>Type "approved" if talents work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` completes without errors
2. `npm run dev` starts without errors
3. TalentsPanel visible in UI
4. Forcing talent offer shows modal
5. Selecting talent adds to TalentsPanel
6. Character.activeModifiers includes talent effects
7. Resource drain rates affected by talent modifiers
</verification>

<success_criteria>
- TalentsPanel shows selected talents with compact cards
- Pending picks indicator visible when picks available
- Dev button forces talent offer for testing
- Character drain rates modified by talent effects
- Human verification confirms visible talent effects
</success_criteria>

<output>
After completion, create `.planning/phases/05-talents-system/05-04-SUMMARY.md`
</output>
