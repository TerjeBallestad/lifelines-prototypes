---
phase: 04-activities-system
plan: 06
type: execute
wave: 5
depends_on: ["04-05"]
files_modified:
  - src/components/ActivityPanel.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Player can see activities organized by domain"
    - "Player can assign activities to the queue"
    - "Activities execute and show results"
  artifacts:
    - path: "src/components/ActivityPanel.tsx"
      provides: "Main activity panel with domain tabs and queue"
      exports: ["ActivityPanel"]
    - path: "src/App.tsx"
      provides: "ActivityPanel integrated into main layout"
      contains: "ActivityPanel"
  key_links:
    - from: "src/components/ActivityPanel.tsx"
      to: "src/components/ActivityCard.tsx"
      via: "renders ActivityCard for selection"
      pattern: "ActivityCard"
    - from: "src/components/ActivityPanel.tsx"
      to: "src/components/ActivityQueue.tsx"
      via: "renders queue display"
      pattern: "ActivityQueue"
    - from: "src/App.tsx"
      to: "src/components/ActivityPanel.tsx"
      via: "import and render"
      pattern: "ActivityPanel"
---

<objective>
Create ActivityPanel with domain tabs for activity selection and integrate into the main application layout.

Purpose: Complete the activity UI so players can browse available activities by domain, assign them to the character, and observe execution.
Output: ActivityPanel.tsx with tabbed selection and queue, integrated into App.tsx layout
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-activities-system/04-CONTEXT.md
@src/components/SkillTreePanel.tsx
@src/components/ActivityCard.tsx
@src/components/ActivityQueue.tsx
@src/stores/ActivityStore.ts
@src/data/activities.ts
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ActivityPanel component</name>
  <files>src/components/ActivityPanel.tsx</files>
  <action>
Create src/components/ActivityPanel.tsx following SkillTreePanel patterns:

```typescript
import { useState } from 'react';
import { observer } from 'mobx-react-lite';
import { useActivityStore } from '../stores/RootStore';
import { STARTER_ACTIVITIES } from '../data/activities';
import { ActivityCard } from './ActivityCard';
import { ActivityQueue } from './ActivityQueue';
import type { SkillDomain } from '../entities/types';

// Domains that have activities (filter out analytical which has no activities yet)
const ACTIVITY_DOMAINS: SkillDomain[] = ['social', 'organisational', 'physical', 'creative'];

const DOMAIN_LABELS: Record<SkillDomain, string> = {
  social: 'Social',
  organisational: 'Organisation',
  physical: 'Physical',
  creative: 'Creative',
  analytical: 'Analytical',
};

export const ActivityPanel = observer(function ActivityPanel() {
  const [selectedDomain, setSelectedDomain] = useState<SkillDomain>('physical');
  const activityStore = useActivityStore();

  // Filter activities by domain
  const domainActivities = STARTER_ACTIVITIES.filter(
    (a) => a.domain === selectedDomain
  );

  // Get domains that have at least one activity
  const availableDomains = ACTIVITY_DOMAINS.filter((domain) =>
    STARTER_ACTIVITIES.some((a) => a.domain === domain)
  );

  const handleSelectActivity = (activityData: typeof STARTER_ACTIVITIES[0]) => {
    activityStore.enqueue(activityData);
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      {/* Left: Activity Selection */}
      <div className="space-y-4">
        <h2 className="text-lg font-bold">Activities</h2>

        {/* Domain Tabs */}
        <div role="tablist" className="tabs tabs-bordered">
          {availableDomains.map((domain) => (
            <button
              key={domain}
              role="tab"
              className={`tab ${selectedDomain === domain ? 'tab-active' : ''}`}
              onClick={() => setSelectedDomain(domain)}
            >
              {DOMAIN_LABELS[domain]}
            </button>
          ))}
        </div>

        {/* Activity List */}
        <div className="space-y-2">
          {domainActivities.length > 0 ? (
            domainActivities.map((activity) => (
              <ActivityCard
                key={activity.id}
                activity={activity}
                variant="preview"
                onSelect={() => handleSelectActivity(activity)}
              />
            ))
          ) : (
            <div className="text-sm text-base-content/50 italic p-4">
              No activities in this domain
            </div>
          )}
        </div>

        {/* Help text */}
        <p className="text-xs text-base-content/50">
          Click an activity to add it to the queue. Activities execute in order when the simulation runs.
        </p>
      </div>

      {/* Right: Activity Queue */}
      <div className="space-y-4">
        <h2 className="text-lg font-bold">Activity Queue</h2>
        <ActivityQueue />
      </div>
    </div>
  );
});
```

Component features:
- Two-column layout: selection (left), queue (right)
- Domain tabs filtering activities
- Click to enqueue activity
- Integrates ActivityCard and ActivityQueue
- Follows SkillTreePanel layout patterns
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>ActivityPanel has domain tabs, activity selection with click-to-queue, and queue display</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ActivityPanel into App</name>
  <files>src/App.tsx</files>
  <action>
Update src/App.tsx to include ActivityPanel:

1. Add import: `import { ActivityPanel } from './components/ActivityPanel';`

2. Add ActivityPanel to the main content area, after SkillTreePanel:

```tsx
<main className="flex-1 p-4 overflow-y-auto">
  <h1 className="text-2xl font-bold mb-6">Lifelines Prototype</h1>
  <SimulationControls />
  <div className="mt-6">
    <SkillTreePanel />
  </div>
  <div className="mt-6">
    <ActivityPanel />
  </div>
</main>
```

This places the activity system below the skill tree, keeping the sidebar for character resources.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Dev server runs without errors: `npm run dev`
  </verify>
  <done>ActivityPanel renders in main layout below SkillTreePanel</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete activity system with queue, execution, and UI</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open browser to http://localhost:5173

**Test Activity Selection:**
3. Scroll down to "Activities" section
4. Click domain tabs (Social, Organisation, Physical, Creative)
5. Click an activity card to add to queue
6. Verify activity appears in "Activity Queue" on right

**Test Activity Execution:**
7. Add 2-3 activities to queue
8. Click "Start" in simulation controls (top of page)
9. Watch current activity show progress bar
10. Observe toast notifications:
    - "Started: [activity name]" when activity begins
    - "Completed: [activity name]!" when activity finishes
11. If character has low overskudd, observe skip toast with narrative message

**Test Resource Effects:**
12. Watch CharacterPanel sidebar during activity execution
13. Verify resources change (energy drains, mood changes, etc.)
14. Try "Rest" activity - verify energy INCREASES (restore activity)

**Test Queue Management:**
15. Add activities to queue, then cancel one (click X)
16. Test "Clear Queue" button

**Test XP:**
17. After completing activities, check skill store domain XP
18. Verify XP badge on skills shows gains from activity domain
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
```bash
# TypeScript compilation
npx tsc --noEmit

# Dev server runs
npm run dev
```

Visual verification (human checkpoint above) confirms:
- Activity selection works
- Queue management works
- Execution with progress works
- Toast notifications appear
- Resource effects apply
- XP awards correctly
</verification>

<success_criteria>
Phase 4 Success Criteria (from ROADMAP.md):
1. [x] 5-8 activities exist that interact with skills and capacities
2. [x] Player can assign an activity to the character
3. [x] Completing activity generates XP for related skills
4. [x] Activities can succeed or fail based on skill level + capacities
5. [x] Activities drain resources based on personality fit

All criteria verified via human checkpoint.
</success_criteria>

<output>
After completion, create `.planning/phases/04-activities-system/04-06-SUMMARY.md`
</output>
