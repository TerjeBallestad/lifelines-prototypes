---
phase: 04-activities-system
plan: 05
type: execute
wave: 4
depends_on: ["04-03", "04-04"]
files_modified:
  - src/components/ActivityCard.tsx
  - src/components/ActivityQueue.tsx
autonomous: true

must_haves:
  truths:
    - "ActivityCard displays activity name, domain, resource preview"
    - "ActivityQueue shows current activity and queued items"
    - "Queue items can be canceled"
  artifacts:
    - path: "src/components/ActivityCard.tsx"
      provides: "Single activity display with preview"
      exports: ["ActivityCard"]
    - path: "src/components/ActivityQueue.tsx"
      provides: "Visual queue with current + pending"
      exports: ["ActivityQueue"]
  key_links:
    - from: "src/components/ActivityCard.tsx"
      to: "src/entities/Activity.ts"
      via: "Activity type prop"
      pattern: "activity.*Activity"
    - from: "src/components/ActivityQueue.tsx"
      to: "src/stores/ActivityStore.ts"
      via: "useActivityStore hook"
      pattern: "useActivityStore"
---

<objective>
Create ActivityCard and ActivityQueue components for displaying the activity queue.

Purpose: Give players visibility into queued activities, current activity progress, and ability to cancel pending activities.
Output: ActivityCard.tsx showing individual activities, ActivityQueue.tsx showing the queue state
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-activities-system/04-CONTEXT.md
@.planning/phases/04-activities-system/04-RESEARCH.md
@src/components/SkillCard.tsx
@src/components/CharacterPanel.tsx
@src/stores/ActivityStore.ts
@src/entities/Activity.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ActivityCard component</name>
  <files>src/components/ActivityCard.tsx</files>
  <action>
Create src/components/ActivityCard.tsx following SkillCard patterns:

```typescript
import { observer } from 'mobx-react-lite';
import type { Activity } from '../entities/Activity';
import type { ActivityData } from '../entities/types';

interface ActivityCardProps {
  activity: Activity | ActivityData;
  variant: 'preview' | 'queued' | 'active';
  onCancel?: () => void;
  onSelect?: () => void;
  progress?: number; // 0-100 for active variant
}

const DOMAIN_COLORS: Record<string, string> = {
  social: 'badge-primary',
  organisational: 'badge-secondary',
  physical: 'badge-accent',
  creative: 'badge-info',
  analytical: 'badge-warning',
};

export const ActivityCard = observer(function ActivityCard({
  activity,
  variant,
  onCancel,
  onSelect,
  progress,
}: ActivityCardProps) {
  const isClickable = variant === 'preview' && onSelect;

  // Format resource effects for preview
  const effectsPreview = Object.entries(activity.resourceEffects)
    .map(([key, val]) => {
      const sign = val! >= 0 ? '+' : '';
      const icon = val! >= 0 ? '↑' : '↓';
      return `${icon} ${key}: ${sign}${val!.toFixed(1)}`;
    })
    .slice(0, 3); // Show max 3

  return (
    <div
      className={`card bg-base-200 shadow-sm ${
        isClickable ? 'cursor-pointer hover:bg-base-300 transition-colors' : ''
      } ${variant === 'active' ? 'ring-2 ring-success' : ''}`}
      onClick={isClickable ? onSelect : undefined}
    >
      <div className="card-body p-3">
        {/* Header */}
        <div className="flex justify-between items-start">
          <div>
            <h3 className="card-title text-sm">{activity.name}</h3>
            <span className={`badge badge-xs ${DOMAIN_COLORS[activity.domain]}`}>
              {activity.domain}
            </span>
          </div>
          {variant === 'queued' && onCancel && (
            <button
              className="btn btn-ghost btn-xs text-error"
              onClick={(e) => {
                e.stopPropagation();
                onCancel();
              }}
              title="Cancel"
            >
              ✕
            </button>
          )}
        </div>

        {/* Description */}
        <p className="text-xs text-base-content/70">{activity.description}</p>

        {/* Resource effects preview */}
        {variant === 'preview' && effectsPreview.length > 0 && (
          <div className="flex flex-wrap gap-1 mt-1">
            {effectsPreview.map((effect, i) => (
              <span key={i} className="badge badge-ghost badge-xs">
                {effect}
              </span>
            ))}
          </div>
        )}

        {/* Progress bar for active */}
        {variant === 'active' && progress !== undefined && (
          <progress
            className="progress progress-success w-full mt-2"
            value={progress}
            max="100"
          />
        )}

        {/* Mastery for queued/active (if Activity instance) */}
        {'masteryLevel' in activity && variant !== 'preview' && (
          <div className="text-xs text-base-content/50 mt-1">
            Mastery Lv.{activity.masteryLevel}
          </div>
        )}
      </div>
    </div>
  );
});
```

Component features:
- Three variants: preview (for selection), queued (in queue), active (currently running)
- Domain badge with color coding
- Resource effects preview (drain/restore indicators)
- Cancel button for queued items
- Progress bar for active activity
- Mastery level display
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>ActivityCard renders with preview/queued/active variants, shows domain, effects, and cancel button</done>
</task>

<task type="auto">
  <name>Task 2: Create ActivityQueue component</name>
  <files>src/components/ActivityQueue.tsx</files>
  <action>
Create src/components/ActivityQueue.tsx:

```typescript
import { observer } from 'mobx-react-lite';
import { useActivityStore, useSimulationStore } from '../stores/RootStore';
import { ActivityCard } from './ActivityCard';

export const ActivityQueue = observer(function ActivityQueue() {
  const activityStore = useActivityStore();
  const simulationStore = useSimulationStore();

  const { currentActivity, currentProgress, queue } = activityStore;

  // Calculate progress percentage for active activity
  const getProgressPercent = (): number => {
    if (!currentActivity) return 0;

    const mode = currentActivity.durationMode;
    switch (mode.type) {
      case 'fixed':
        return Math.min(100, (currentProgress / mode.ticks) * 100);
      case 'variable': {
        const adjusted = mode.baseTicks * (1 - currentActivity.masterySpeedBonus);
        return Math.min(100, (currentProgress / adjusted) * 100);
      }
      case 'threshold':
        // Threshold activities don't have predictable progress
        return 50; // Show indeterminate middle
    }
  };

  return (
    <div className="space-y-3">
      {/* Current Activity */}
      <div>
        <h4 className="text-sm font-semibold mb-2 flex items-center gap-2">
          Current Activity
          {simulationStore.isRunning && currentActivity && (
            <span className="loading loading-spinner loading-xs"></span>
          )}
        </h4>
        {currentActivity ? (
          <ActivityCard
            activity={currentActivity}
            variant="active"
            progress={getProgressPercent()}
          />
        ) : (
          <div className="text-sm text-base-content/50 italic p-3 bg-base-200 rounded-lg">
            No activity in progress
          </div>
        )}
      </div>

      {/* Queued Activities */}
      <div>
        <h4 className="text-sm font-semibold mb-2">
          Queue ({queue.length})
        </h4>
        {queue.length > 0 ? (
          <div className="space-y-2">
            {queue.map((activity, index) => (
              <ActivityCard
                key={`${activity.id}-${index}`}
                activity={activity}
                variant="queued"
                onCancel={() => activityStore.cancel(index)}
              />
            ))}
          </div>
        ) : (
          <div className="text-sm text-base-content/50 italic p-3 bg-base-200 rounded-lg">
            Queue empty - add activities from the panel
          </div>
        )}
      </div>

      {/* Quick Actions */}
      {queue.length > 0 && (
        <button
          className="btn btn-sm btn-ghost btn-block text-error"
          onClick={() => activityStore.clearQueue()}
        >
          Clear Queue
        </button>
      )}
    </div>
  );
});
```

Component features:
- Shows current activity with progress bar
- Lists queued activities with cancel buttons
- Loading spinner when simulation running
- Empty states with helpful messages
- Clear queue button
- Reactively updates via MobX observer
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>ActivityQueue shows current activity with progress, queued items with cancel, and clear queue action</done>
</task>

</tasks>

<verification>
```bash
# TypeScript compilation
npx tsc --noEmit

# Check components can be imported
npx tsx -e "
import { ActivityCard } from './src/components/ActivityCard';
import { ActivityQueue } from './src/components/ActivityQueue';
console.log('Components OK');
"
```
</verification>

<success_criteria>
- TypeScript compiles without errors
- ActivityCard has preview/queued/active variants
- ActivityCard shows domain badge, description, resource effects
- ActivityQueue shows current activity with progress
- ActivityQueue shows pending queue with cancel buttons
- Components use MobX observer for reactivity
- Follows existing component patterns (SkillCard, CharacterPanel)
</success_criteria>

<output>
After completion, create `.planning/phases/04-activities-system/04-05-SUMMARY.md`
</output>
