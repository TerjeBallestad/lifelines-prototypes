# Milestone v1.1: Game Balance

**Status:** ✅ SHIPPED 2026-01-27
**Phases:** 7-12 (including 9.1, 10.1)
**Total Plans:** 30

## Overview

v1.1 transforms the flat resource system into an interconnected needs-based simulation inspired by The Sims. Seven primary needs (Hunger, Energy, Hygiene, Bladder, Social, Fun, Security) decay at differential rates and feed into derived wellbeing (Mood, Purpose), which determines action resources (Overskudd, socialBattery, Focus, Willpower). Patients autonomously select activities based on need urgency, personality alignment, and resource availability, creating emergent behavior from simple rules. The journey moves bottom-up through dependency layers: establish primary needs foundation → derive wellbeing stats → compute action resources → integrate with activities → implement autonomous AI → tune for balance.

## Phases

### Phase 7: Primary Needs Foundation

**Goal**: Seven primary needs exist with differential decay rates and visual feedback, forming the foundation for all derived stats.
**Depends on**: Phase 6 (v1.0 completion)
**Plans**: 3 plans

Plans:
- [x] 07-01-PLAN.md — Types, config, and Character needs decay logic
- [x] 07-02-PLAN.md — Toggle wiring, NeedsPanel UI components
- [x] 07-03-PLAN.md — Human verification checkpoint

**Details:**
- 7 primary needs (Hunger, Energy, Hygiene, Bladder, Social, Fun, Security)
- Asymptotic decay prevents death spirals
- Color-coded urgency (green/yellow/orange/red)
- Critical threshold at 20% with pulse animation
- Requirements: NEED-01 through NEED-05, MIGR-01

### Phase 8: Derived Wellbeing

**Goal**: Mood and Purpose emerge as computed stats from primary needs and activity-personality alignment, affecting patient capability.
**Depends on**: Phase 7
**Plans**: 4 plans

Plans:
- [x] 08-01-PLAN.md — Types, config, curve and smoothing utilities
- [x] 08-02-PLAN.md — Character integration (Mood, Purpose, Nutrition logic)
- [x] 08-03-PLAN.md — UI components (MoodIcon, DerivedStatsSection)
- [x] 08-04-PLAN.md — Human verification checkpoint

**Details:**
- Mood computed via sigmoid curves from weighted need satisfaction
- Mood floor (10) prevents death spiral from one bad need
- Purpose equilibrium based on Conscientiousness + Openness
- Nutrition as slow-moving health stat (90/10 EMA)
- Requirements: WELL-01 through WELL-04, NEED-06

### Phase 9: Action Resources

**Goal**: Overskudd, socialBattery, Focus, and Willpower are computed from needs and personality, gating which activities are affordable.
**Depends on**: Phase 8
**Plans**: 3 plans

Plans:
- [x] 09-01-PLAN.md — Types, config, and Character action resources logic
- [x] 09-02-PLAN.md — ActionResourcesSection UI and NeedsPanel integration
- [x] 09-03-PLAN.md — Human verification checkpoint

**Details:**
- Overskudd derived from mood, energy, purpose, willpower
- socialBattery inverts at Extraversion 40/60 (introvert/extrovert)
- Focus spent on concentration tasks
- Willpower boosts Overskudd recovery
- Native Popover API established as tooltip standard
- Requirements: RSRC-01 through RSRC-05

### Phase 9.1: Activity Difficulty (INSERTED)

**Goal**: Activities have difficulty ratings calculated from skill level and mastery, with visual display for player decision-making.
**Depends on**: Phase 9
**Plans**: 3 plans

Plans:
- [x] 09.1-01-PLAN.md — Difficulty types, config, and Activity calculation methods
- [x] 09.1-02-PLAN.md — Activity data and DifficultyStars UI component
- [x] 09.1-03-PLAN.md — Human verification checkpoint

**Details:**
- Base difficulty (1-5 stars) with skill requirements
- Square root diminishing returns for skills and mastery
- Max 1.5 stars reduction from skills, 1.0 from mastery
- Color-coded stars (success/warning/error)
- Requirements: ACTV-02 (partial - calculation only)

### Phase 10: Activity-Need Integration

**Goal**: Activities restore specific needs, consume resources scaled by difficulty, and integrate personality alignment, creating the gameplay loop.
**Depends on**: Phase 9.1
**Plans**: 5 plans

Plans:
- [x] 10-01-PLAN.md — Core types (tags, needEffects) and personality alignment utility
- [x] 10-02-PLAN.md — Activity.getResourceCosts method and starter activities data
- [x] 10-03-PLAN.md — Need restoration and cost integration in ActivityStore
- [x] 10-04-PLAN.md — UI feedback (FloatingNumber, tooltips, completion summary)
- [x] 10-05-PLAN.md — Human verification checkpoint

**Details:**
- Activities restore specific needs (eating → Hunger)
- Difficulty-to-cost linear scaling (1:1)
- Personality alignment modifies costs and gains (0.6-1.4 range)
- Escape valve: 50% cost reduction when needs below 20%
- FloatingNumber animations for visual feedback
- Requirements: ACTV-01 through ACTV-04

### Phase 10.1: Remove v1.0 Resource System (INSERTED)

**Goal**: Remove legacy v1.0 flat resource system now that v1.1 needs-based system is verified, reducing code complexity and UI clutter.
**Depends on**: Phase 10
**Plans**: 3 plans

Plans:
- [x] 10.1-01-PLAN.md — Remove toggle UI and conditional rendering
- [x] 10.1-02-PLAN.md — Remove v1.0 from stores, types, and activity data
- [x] 10.1-03-PLAN.md — Human verification checkpoint

**Details:**
- needsSystemEnabled toggle removed
- Character.needs/derivedStats/actionResources now required
- ResourcePanel deleted, resourceEffects removed from activities
- Net reduction: ~420 lines across 7 files
- Character entity reduced by 253 lines (21% smaller)
- Requirements: MIGR-01 (cleanup)

### Phase 11: Autonomous AI

**Goal**: Patient autonomously selects activities based on utility scoring of need urgency, personality fit, and resource availability.
**Depends on**: Phase 10
**Plans**: 4 plans

Plans:
- [x] 11-01-PLAN.md — Types and utility scoring functions
- [x] 11-02-PLAN.md — UtilityAIStore and Character freeWill integration
- [x] 11-03-PLAN.md — Simulation tick wiring and UI (DecisionLogPanel, Free Will toggle)
- [x] 11-04-PLAN.md — Human verification checkpoint

**Details:**
- 5 utility factors: needUrgency (30%), personalityFit (20%), resourceAvailability (15%), willpowerMatch (15%), moodDelta (20%)
- Critical mode at 15% threshold overrides personality preferences
- Hysteresis bonus (25%) prevents constant switching
- Weighted random from top 3-5 options for variety
- Satiation penalty (negative urgency when > 80%) prevents wasteful activities
- Survival activities (eat, bathroom, shower, rest) have no personality tags
- Requirements: AUTO-01 through AUTO-04

### Phase 12: Tuning & Balance

**Goal**: Decay rates, formulas, and thresholds are tuned for sustainable gameplay loops without death spirals or boring maintenance.
**Depends on**: Phase 11
**Plans**: 5 plans

Plans:
- [x] 12-01-PLAN.md — Calculation trace panel for formula breakdowns
- [x] 12-02-PLAN.md — Balance config localStorage persistence and presets
- [x] 12-03-PLAN.md — Headless simulation runner with telemetry capture
- [x] 12-04-PLAN.md — Simulation UI and Recharts telemetry visualization
- [x] 12-05-PLAN.md — Human verification checkpoint

**Details:**
- CalculationTracePanel with 2-layer nested expansion
- localStorage auto-persistence for BalanceConfig (500ms debounce)
- Preset save/load/delete system
- TelemetryStore captures all 7 needs, 3 derived stats, 4 action resources per tick
- runHeadlessSimulation with async yielding every 100 ticks
- 7-day simulation (10,080 ticks) with configurable sample rate
- Recharts LineChart visualization with comparison overlay
- Requirements: MIGR-02, MIGR-03

---

## Milestone Summary

**Decimal Phases:**
- Phase 9.1: Activity Difficulty (inserted after Phase 9 for calculation foundation)
- Phase 10.1: Remove v1.0 Resources (inserted after Phase 10 for cleanup)

**Key Decisions:**
- Bottom-up dependency chain: Primary needs → Derived wellbeing → Action resources → Autonomous AI
- MobX computed values for reactive needs derivation
- Native Popover API for tooltips (fixing DaisyUI overflow issues)
- Satiation penalty: needs > 80% get negative urgency
- Neutral cap pattern: "can I?" factors cap at 50, "should I?" factors vary
- Survival activities personality-neutral (eating/bathroom universal)
- Square root diminishing returns for skill/mastery difficulty reduction

**Issues Resolved:**
- Death spiral prevention via mood floor and asymptotic decay
- Tooltip overflow via Native Popover API migration
- AI activity selection balance via satiation penalty and neutral caps
- Headless simulation blocking via TalentStore.headlessMode flag
- MobX/Recharts compatibility via toJS() conversion

**Issues Deferred:**
- None - all phase gaps closed within milestone

**Technical Debt Incurred:**
- Skills are global (SkillStore), not per-character - pre-existing from v1.0
- No significant new debt added in v1.1

---

*For current project status, see .planning/ROADMAP.md*
